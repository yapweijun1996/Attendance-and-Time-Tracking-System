import{E as Ae,v as $t,a as Cn,M as pt}from"./vendor-C_7N_xUH.js";function dr(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer||typeof Blob<"u"&&t instanceof Blob}function hr(t){return t instanceof ArrayBuffer?t.slice(0):t.slice(0,t.size,t.type)}var En=Function.prototype.toString,vr=En.call(Object);function _r(t){var e=Object.getPrototypeOf(t);if(e===null)return!0;var n=e.constructor;return typeof n=="function"&&n instanceof n&&En.call(n)==vr}function se(t){var e,n,r;if(!t||typeof t!="object")return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=se(t[n]);return e}if(t instanceof Date&&isFinite(t))return t.toISOString();if(dr(t))return hr(t);if(!_r(t))return t;e={};for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=se(t[n]);typeof i<"u"&&(e[n]=i)}return e}function xn(t){var e=!1;return function(...n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)}}function Tn(t){return function(...e){e=se(e);var n=this,r=typeof e[e.length-1]=="function"?e.pop():!1,i=new Promise(function(a,s){var u;try{var c=xn(function(l,g){l?s(l):a(g)});e.push(c),u=t.apply(n,e),u&&typeof u.then=="function"&&a(u)}catch(l){s(l)}});return r&&i.then(function(a){r(null,a)},r),i}}function gr(t,e,n){if(t.constructor.listeners("debug").length){for(var r=["api",t.name,e],i=0;i<n.length-1;i++)r.push(n[i]);t.constructor.emit("debug",r);var a=n[n.length-1];n[n.length-1]=function(s,u){var c=["api",t.name,e];c=c.concat(s?["error",s]:["success",u]),t.constructor.emit("debug",c),a(s,u)}}}function te(t,e){return Tn(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return gr(r,t,n),this.taskqueue.isReady?e.apply(this,n):new Promise(function(i,a){r.taskqueue.addTask(function(s){s?a(s):i(r[t].apply(r,n))})})})}function Ue(t,e){for(var n={},r=0,i=e.length;r<i;r++){var a=e[r];a in t&&(n[a]=t[a])}return n}var mr=6;function Zt(t){return t}function yr(t){return[{ok:t}]}function Pn(t,e,n){var r=e.docs,i=new Map;r.forEach(function(S){i.has(S.id)?i.get(S.id).push(S):i.set(S.id,[S])});var a=i.size,s=0,u=new Array(a);function c(){var S=[];u.forEach(function(_){_.docs.forEach(function(d){S.push({id:_.id,docs:[d]})})}),n(null,{results:S})}function l(){++s===a&&c()}function g(S,_,d){u[S]={id:_,docs:d},l()}var o=[];i.forEach(function(S,_){o.push(_)});var f=0;function v(){if(!(f>=o.length)){var S=Math.min(f+mr,o.length),_=o.slice(f,S);p(_,f),f+=_.length}}function p(S,_){S.forEach(function(d,m){var y=_+m,O=i.get(d),q=Ue(O[0],["atts_since","attachments"]);q.open_revs=O.map(function(T){return T.rev}),q.open_revs=q.open_revs.filter(Zt);var x=Zt;q.open_revs.length===0&&(delete q.open_revs,x=yr),["revs","attachments","binary","ajax","latest"].forEach(function(T){T in e&&(q[T]=e[T])}),t.get(d,q,function(T,P){var C;T?C=[{error:T}]:C=x(P),g(y,d,C),v()})})}v()}var wt;try{localStorage.setItem("_pouch_check_localstorage",1),wt=!!localStorage.getItem("_pouch_check_localstorage")}catch{wt=!1}function Ye(){return wt}const ke=typeof queueMicrotask=="function"?queueMicrotask:function(e){Promise.resolve().then(e)};class pr extends Ae{constructor(){super(),this._listeners={},Ye()&&addEventListener("storage",e=>{this.emit(e.key)})}addListener(e,n,r,i){if(this._listeners[n])return;var a=!1,s=this;function u(){if(!s._listeners[n])return;if(a){a="waiting";return}a=!0;var c=Ue(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function l(){a=!1}r.changes(c).on("change",function(g){g.seq>i.since&&!i.cancelled&&(i.since=g.seq,i.onChange(g))}).on("complete",function(){a==="waiting"&&ke(u),a=!1}).on("error",l)}this._listeners[n]=u,this.on(e,u)}removeListener(e,n){n in this._listeners&&(super.removeListener(e,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(e){Ye()&&(localStorage[e]=localStorage[e]==="a"?"b":"a")}notify(e){this.emit(e),this.notifyLocalWindows(e)}}function ve(t){if(typeof console<"u"&&typeof console[t]=="function"){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function wr(t,e){var n=6e5;t=parseInt(t,10)||0,e=parseInt(e,10),e!==e||e<=t?e=(t||1)<<1:e=e+1,e>n&&(t=n>>1,e=n);var r=Math.random(),i=e-t;return~~(i*r+t)}function br(t){var e=0;return t||(e=2e3),wr(t,e)}function bt(t,e){ve("info","The above "+t+" is totally normal. "+e)}class V extends Error{constructor(e,n,r){super(),this.status=e,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new V(401,"unauthorized","Name or password is incorrect.");var Sr=new V(400,"bad_request","Missing JSON list of 'docs'"),de=new V(404,"not_found","missing"),Le=new V(409,"conflict","Document update conflict"),Rn=new V(400,"bad_request","_id field must contain a string"),kr=new V(412,"missing_id","_id is required for puts"),qr=new V(400,"bad_request","Only reserved document ids may start with underscore.");new V(412,"precondition_failed","Database not open");var Lt=new V(500,"unknown_error","Database encountered an unknown error"),Bn=new V(500,"badarg","Some query argument is invalid");new V(400,"invalid_request","Request was invalid");var Ar=new V(400,"query_parse_error","Some query parameter is invalid"),Vt=new V(500,"doc_validation","Bad special document member"),tt=new V(400,"bad_request","Something wrong with the request"),st=new V(400,"bad_request","Document must be a JSON object");new V(404,"not_found","Database not found");var Nt=new V(500,"indexed_db_went_bad","unknown");new V(500,"web_sql_went_bad","unknown");new V(500,"levelDB_went_went_bad","unknown");new V(403,"forbidden","Forbidden by design doc validate_doc_update function");var We=new V(400,"bad_request","Invalid rev format");new V(412,"file_exists","The database could not be created, the file already exists.");var Or=new V(412,"missing_stub","A pre-existing attachment stub wasn't found");new V(413,"invalid_url","Provided URL is invalid");function G(t,e){function n(r){for(var i=Object.getOwnPropertyNames(t),a=0,s=i.length;a<s;a++)typeof t[i[a]]!="function"&&(this[i[a]]=t[i[a]]);this.stack===void 0&&(this.stack=new Error().stack),r!==void 0&&(this.reason=r)}return n.prototype=V.prototype,new n(e)}function Ne(t){if(typeof t!="object"){var e=t;t=Lt,t.data=e}return"error"in t&&t.error==="conflict"&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),"stack"in t||(t.stack=new Error().stack),t}function Dr(t,e,n){try{return!t(e,n)}catch(i){var r="Filter function threw: "+i.toString();return G(tt,r)}}function Kt(t){var e={},n=t.filter&&typeof t.filter=="function";return e.query=t.query_params,function(i){i.doc||(i.doc={});var a=n&&Dr(t.filter,i.doc,e);if(typeof a=="object")return a;if(a)return!1;if(!t.include_docs)delete i.doc;else if(!t.attachments)for(var s in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,s)&&(i.doc._attachments[s].stub=!0);return!0}}function In(t){var e;if(t?typeof t!="string"?e=G(Rn):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=G(qr)):e=G(kr),e)throw e}function Se(t){return typeof t._remote=="boolean"?t._remote:typeof t.type=="function"?(ve("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),t.type()==="http"):!1}function Cr(t,e){return"listenerCount"in t?t.listenerCount(e):Ae.listenerCount(t,e)}function St(t){if(!t)return null;var e=t.split("/");return e.length===2?e:e.length===1?[t,t]:null}function en(t){var e=St(t);return e?e.join("/"):null}var tn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],nn="queryKey",Er=/(?:^|&)([^&=]*)=?([^&]*)/g,xr=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function jn(t){for(var e=xr.exec(t),n={},r=14;r--;){var i=tn[r],a=e[r]||"",s=["user","password"].indexOf(i)!==-1;n[i]=s?decodeURIComponent(a):a}return n[nn]={},n[tn[12]].replace(Er,function(u,c,l){c&&(n[nn][c]=l)}),n}function Ft(t,e){var n=[],r=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n.push(i),r.push(e[i]));return n.push(t),Function.apply(null,n).apply(null,r)}function Xe(t,e,n){return t.get(e).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,a=n(r);return a?(a._id=e,a._rev=i,Tr(t,a,n)):{updated:!1,rev:i}})}function Tr(t,e,n){return t.put(e).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return Xe(t,e._id,n)})}var Mt=function(t){return atob(t)},Je=function(t){return btoa(t)};function Gt(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(a){if(a.name!=="TypeError")throw a;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<t.length;i+=1)r.append(t[i]);return r.getBlob(e.type)}}function Pr(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n}function Ut(t,e){return Gt([Pr(t)],{type:e})}function Jt(t,e){return Ut(Mt(t),e)}function Rr(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return e}function $n(t,e){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var a=i.target.result||"";if(r)return e(a);e(Rr(a))},r?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function Ln(t,e){$n(t,function(n){e(n)})}function zt(t,e){Ln(t,function(n){e(Je(n))})}function Br(t,e){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);e(i)},n.readAsArrayBuffer(t)}var Ir=self.setImmediate||self.setTimeout,jr=32768;function $r(t){return Je(t)}function Lr(t,e,n,r,i){(n>0||r<e.size)&&(e=e.slice(n,r)),Br(e,function(a){t.append(a),i()})}function Nr(t,e,n,r,i){(n>0||r<e.length)&&(e=e.substring(n,r)),t.appendBinary(e),i()}function Qt(t,e){var n=typeof t=="string",r=n?t.length:t.size,i=Math.min(jr,r),a=Math.ceil(r/i),s=0,u=n?new pt:new pt.ArrayBuffer,c=n?Nr:Lr;function l(){Ir(o)}function g(){var f=u.end(!0),v=$r(f);e(v),u.destroy()}function o(){var f=s*i,v=f+i;s++,s<a?c(u,t,f,v,l):c(u,t,f,v,g)}o()}function Nn(t){return pt.hash(t)}function Kn(t,e){if(!e)return $t().replace(/-/g,"").toLowerCase();var n=Object.assign({},t);return delete n._rev_tree,Nn(JSON.stringify(n))}var nt=$t;function Pe(t){for(var e,n,r,i=t.rev_tree.slice(),a;a=i.pop();){var s=a.ids,u=s[2],c=a.pos;if(u.length){for(var l=0,g=u.length;l<g;l++)i.push({pos:c+1,ids:u[l]});continue}var o=!!s[1].deleted,f=s[0];(!e||(r!==o?r:n!==c?n<c:e<f))&&(e=f,n=c,r=o)}return n+"-"+e}function Re(t,e){for(var n=t.slice(),r;r=n.pop();)for(var i=r.pos,a=r.ids,s=a[2],u=e(s.length===0,i,a[0],r.ctx,a[1]),c=0,l=s.length;c<l;c++)n.push({pos:i+1,ids:s[c],ctx:u})}function Kr(t,e){return t.pos-e.pos}function Wt(t){var e=[];Re(t,function(i,a,s,u,c){i&&e.push({rev:a+"-"+s,pos:a,opts:c})}),e.sort(Kr).reverse();for(var n=0,r=e.length;n<r;n++)delete e[n].pos;return e}function Ht(t){for(var e=Pe(t),n=Wt(t.rev_tree),r=[],i=0,a=n.length;i<a;i++){var s=n[i];s.rev!==e&&!s.opts.deleted&&r.push(s.rev)}return r}function Fr(t){var e=[];return Re(t.rev_tree,function(n,r,i,a,s){s.status==="available"&&!n&&(e.push(r+"-"+i),s.status="missing")}),e}function Mr(t,e){let n=[];const r=t.slice();let i;for(;i=r.pop();){const{pos:a,ids:s}=i,u=`${a}-${s[0]}`,c=s[2];if(n.push(u),u===e){if(c.length!==0)throw new Error("The requested revision is not a leaf");return n.reverse()}(c.length===0||c.length>1)&&(n=[]);for(let l=0,g=c.length;l<g;l++)r.push({pos:a+1,ids:c[l]})}if(n.length===0)throw new Error("The requested revision does not exist");return n.reverse()}function Fn(t){for(var e=[],n=t.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,s=a[0],u=a[1],c=a[2],l=c.length===0,g=r.history?r.history.slice():[];g.push({id:s,opts:u}),l&&e.push({pos:i+1-g.length,ids:g});for(var o=0,f=c.length;o<f;o++)n.push({pos:i+1,ids:c[o],history:g})}return e.reverse()}function Gr(t,e){return t.pos-e.pos}function Ur(t,e,n){for(var r=0,i=t.length,a;r<i;)a=r+i>>>1,n(t[a],e)<0?r=a+1:i=a;return r}function Jr(t,e,n){var r=Ur(t,e,n);t.splice(r,0,e)}function rn(t,e){for(var n,r,i=e,a=t.length;i<a;i++){var s=t[i],u=[s.id,s.opts,[]];r?(r[2].push(u),r=u):n=r=u}return n}function zr(t,e){return t[0]<e[0]?-1:1}function an(t,e){for(var n=[{tree1:t,tree2:e}],r=!1;n.length>0;){var i=n.pop(),a=i.tree1,s=i.tree2;(a[1].status||s[1].status)&&(a[1].status=a[1].status==="available"||s[1].status==="available"?"available":"missing");for(var u=0;u<s[2].length;u++){if(!a[2][0]){r="new_leaf",a[2][0]=s[2][u];continue}for(var c=!1,l=0;l<a[2].length;l++)a[2][l][0]===s[2][u][0]&&(n.push({tree1:a[2][l],tree2:s[2][u]}),c=!0);c||(r="new_branch",Jr(a[2],s[2][u],zr))}}return{conflicts:r,tree:t}}function Mn(t,e,n){var r=[],i=!1,a=!1,s;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var u=0,c=t.length;u<c;u++){var l=t[u];if(l.pos===e.pos&&l.ids[0]===e.ids[0])s=an(l.ids,e.ids),r.push({pos:l.pos,ids:s.tree}),i=i||s.conflicts,a=!0;else if(n!==!0){var g=l.pos<e.pos?l:e,o=l.pos<e.pos?e:l,f=o.pos-g.pos,v=[],p=[];for(p.push({ids:g.ids,diff:f,parent:null,parentIdx:null});p.length>0;){var S=p.pop();if(S.diff===0){S.ids[0]===o.ids[0]&&v.push(S);continue}for(var _=S.ids[2],d=0,m=_.length;d<m;d++)p.push({ids:_[d],diff:S.diff-1,parent:S.ids,parentIdx:d})}var y=v[0];y?(s=an(y.ids,o.ids),y.parent[2][y.parentIdx]=s.tree,r.push({pos:g.pos,ids:g.ids}),i=i||s.conflicts,a=!0):r.push(l)}else r.push(l)}return a||r.push(e),r.sort(Gr),{tree:r,conflicts:i||"internal_node"}}function Qr(t,e){for(var n=Fn(t),r,i,a=0,s=n.length;a<s;a++){var u=n[a],c=u.ids,l;if(c.length>e){r||(r={});var g=c.length-e;l={pos:u.pos+g,ids:rn(c,g)};for(var o=0;o<g;o++){var f=u.pos+o+"-"+c[o].id;r[f]=!0}}else l={pos:u.pos,ids:rn(c,0)};i?i=Mn(i,l,!0).tree:i=[l]}return r&&Re(i,function(v,p,S){delete r[p+"-"+S]}),{tree:i,revs:r?Object.keys(r):[]}}function Gn(t,e,n){var r=Mn(t,e),i=Qr(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Wr(t,e){for(var n=t.slice(),r=e.split("-"),i=parseInt(r[0],10),a=r[1],s;s=n.pop();){if(s.pos===i&&s.ids[0]===a)return!0;for(var u=s.ids[2],c=0,l=u.length;c<l;c++)n.push({pos:s.pos+1,ids:u[c]})}return!1}function Hr(t){return t.ids}function qe(t,e){e||(e=Pe(t));for(var n=e.substring(e.indexOf("-")+1),r=t.rev_tree.map(Hr),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function Te(t){return typeof t=="string"&&t.startsWith("_local/")}function Yr(t,e){for(var n=e.rev_tree.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,s=a[0],u=a[1],c=a[2],l=c.length===0,g=r.history?r.history.slice():[];if(g.push({id:s,pos:i,opts:u}),l)for(var o=0,f=g.length;o<f;o++){var v=g[o],p=v.pos+"-"+v.id;if(p===t)return i+"-"+s}for(var S=0,_=c.length;S<_;S++)n.push({pos:i+1,ids:c[S],history:g})}throw new Error("Unable to resolve latest revision for id "+e.id+", rev "+t)}function Xr(t,e,n,r){try{t.emit("change",e,n,r)}catch(i){ve("error",'Error in .on("change", function):',i)}}function Zr(t,e,n){var r=[{rev:t._rev}];n.style==="all_docs"&&(r=Wt(e.rev_tree).map(function(a){return{rev:a.rev}}));var i={id:e.id,changes:r,doc:t};return qe(e,t._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=Ht(e),i.doc._conflicts.length||delete i.doc._conflicts),i}class Vr extends Ae{constructor(e,n,r){super(),this.db=e,n=n?se(n):{};var i=n.complete=xn((u,c)=>{u?Cr(this,"error")>0&&this.emit("error",u):this.emit("complete",c),this.removeAllListeners(),e.removeListener("destroyed",a)});r&&(this.on("complete",function(u){r(null,u)}),this.on("error",r));const a=()=>{this.cancel()};e.once("destroyed",a),n.onChange=(u,c,l)=>{this.isCancelled||Xr(this,u,c,l)};var s=new Promise(function(u,c){n.complete=function(l,g){l?c(l):u(g)}});this.once("cancel",function(){e.removeListener("destroyed",a),n.complete(null,{status:"cancelled"})}),this.then=s.then.bind(s),this.catch=s.catch.bind(s),this.then(function(u){i(null,u)},i),e.taskqueue.isReady?this.validateChanges(n):e.taskqueue.addTask(u=>{u?n.complete(u):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(e){var n=e.complete;J._changesFilterPlugin?J._changesFilterPlugin.validate(e,r=>{if(r)return n(r);this.doChanges(e)}):this.doChanges(e)}doChanges(e){var n=e.complete;if(e=se(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=Zr,e.since==="latest"&&(e.since="now"),e.since||(e.since=0),e.since==="now"){this.db.info().then(i=>{if(this.isCancelled){n(null,{status:"cancelled"});return}e.since=i.update_seq,this.doChanges(e)},n);return}if(J._changesFilterPlugin){if(J._changesFilterPlugin.normalize(e),J._changesFilterPlugin.shouldFilter(this,e))return J._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(i){i in e&&ve("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in e||(e.descending=!1),e.limit=e.limit===0?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&typeof r.cancel=="function"){const i=this.cancel;this.cancel=(...a)=>{r.cancel(),i.apply(this,a)}}}}function ot(t,e){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=e,t(n)):t(null,r.length?r[0]:r)}}function ei(t){for(var e=0;e<t.length;e++){var n=t[e];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var a=r[i];n._attachments[a]=Ue(n._attachments[a],["data","digest","content_type","length","revpos","stub"])}}}function ti(t,e){if(t._id===e._id){const n=t._revisions?t._revisions.start:0,r=e._revisions?e._revisions.start:0;return n-r}return t._id<e._id?-1:1}function ni(t){var e={},n=[];return Re(t,function(r,i,a,s){var u=i+"-"+a;return r&&(e[u]=0),s!==void 0&&n.push({from:s,to:u}),u}),n.reverse(),n.forEach(function(r){e[r.from]===void 0?e[r.from]=1+e[r.to]:e[r.from]=Math.min(e[r.from],1+e[r.to])}),e}function ri(t){var e="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;t.keys=e,t.skip=0,delete t.limit,t.descending&&(e.reverse(),t.descending=!1)}function Un(t){var e=t._compactionQueue[0],n=e.opts,r=e.callback;t.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),t._compact(n,function(a,s){a?r(a):r(null,s),ke(function(){t._compactionQueue.shift(),t._compactionQueue.length&&Un(t)})})})}function ii(t,e,n){return t.get("_local/purges").then(function(r){const i=r.purgeSeq+1;return r.purges.push({docId:e,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(r.status!==404)throw r;return{_id:"_local/purges",purges:[{docId:e,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return t.put(r)})}function ai(t){return t.charAt(0)==="_"?t+" is not a valid attachment name, attachment names cannot start with '_'":!1}function ut(t){return t===null||typeof t!="object"||Array.isArray(t)}const si=/^\d+-[^-]*$/;function ct(t){return typeof t=="string"&&si.test(t)}class Jn extends Ae{_setup(){this.post=te("post",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),ut(e))return r(G(st));this.bulkDocs({docs:[e]},n,ot(r,e._id))}).bind(this),this.put=te("put",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),ut(e))return r(G(st));if(In(e._id),"_rev"in e&&!ct(e._rev))return r(G(We));if(Te(e._id)&&typeof this._putLocal=="function")return e._deleted?this._removeLocal(e,r):this._putLocal(e,r);const i=s=>{typeof this._put=="function"&&n.new_edits!==!1?this._put(e,n,s):this.bulkDocs({docs:[e]},n,ot(s,e._id))};n.force&&e._rev?(a(),i(function(s){var u=s?null:{ok:!0,id:e._id,rev:e._rev};r(s,u)})):i(r);function a(){var s=e._rev.split("-"),u=s[1],c=parseInt(s[0],10),l=c+1,g=Kn();e._revisions={start:l,ids:[g,u]},e._rev=l+"-"+g,n.new_edits=!1}}).bind(this),this.putAttachment=te("putAttachment",function(e,n,r,i,a){var s=this;typeof a=="function"&&(a=i,i=r,r=null),typeof a>"u"&&(a=i,i=r,r=null),a||ve("warn","Attachment",n,"on document",e,"is missing content_type");function u(c){var l="_rev"in c?parseInt(c._rev,10):0;return c._attachments=c._attachments||{},c._attachments[n]={content_type:a,data:i,revpos:++l},s.put(c)}return s.get(e).then(function(c){if(c._rev!==r)throw G(Le);return u(c)},function(c){if(c.reason===de.message)return u({_id:e});throw c})}).bind(this),this.removeAttachment=te("removeAttachment",function(e,n,r,i){this.get(e,(a,s)=>{if(a){i(a);return}if(s._rev!==r){i(G(Le));return}if(!s._attachments)return i();delete s._attachments[n],Object.keys(s._attachments).length===0&&delete s._attachments,this.put(s,i)})}).bind(this),this.remove=te("remove",function(e,n,r,i){var a;typeof n=="string"?(a={_id:e,_rev:n},typeof r=="function"&&(i=r,r={})):(a=e,typeof n=="function"?(i=n,r={}):(i=r,r=n)),r=r||{},r.was_delete=!0;var s={_id:a._id,_rev:a._rev||r.rev};if(s._deleted=!0,Te(s._id)&&typeof this._removeLocal=="function")return this._removeLocal(a,i);this.bulkDocs({docs:[s]},r,ot(i,s._id))}).bind(this),this.revsDiff=te("revsDiff",function(e,n,r){typeof n=="function"&&(r=n,n={});var i=Object.keys(e);if(!i.length)return r(null,{});var a=0,s=new Map;function u(l,g){s.has(l)||s.set(l,{missing:[]}),s.get(l).missing.push(g)}function c(l,g){var o=e[l].slice(0);Re(g,function(f,v,p,S,_){var d=v+"-"+p,m=o.indexOf(d);m!==-1&&(o.splice(m,1),_.status!=="available"&&u(l,d))}),o.forEach(function(f){u(l,f)})}i.forEach(function(l){this._getRevisionTree(l,function(g,o){if(g&&g.status===404&&g.message==="missing")s.set(l,{missing:e[l]});else{if(g)return r(g);c(l,o)}if(++a===i.length){var f={};return s.forEach(function(v,p){f[p]=v}),r(null,f)}})},this)}).bind(this),this.bulkGet=te("bulkGet",function(e,n){Pn(this,e,n)}).bind(this),this.compactDocument=te("compactDocument",function(e,n,r){this._getRevisionTree(e,(i,a)=>{if(i)return r(i);var s=ni(a),u=[],c=[];Object.keys(s).forEach(function(l){s[l]>n&&u.push(l)}),Re(a,function(l,g,o,f,v){var p=g+"-"+o;v.status==="available"&&u.indexOf(p)!==-1&&c.push(p)}),this._doCompaction(e,c,r)})}).bind(this),this.compact=te("compact",function(e,n){typeof e=="function"&&(n=e,e={}),e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:n}),this._compactionQueue.length===1&&Un(this)}).bind(this),this.get=te("get",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},typeof e!="string")return r(G(Rn));if(Te(e)&&typeof this._getLocal=="function")return this._getLocal(e,r);var i=[];const a=()=>{var c=[],l=i.length;if(!l)return r(null,c);i.forEach(g=>{this.get(e,{rev:g,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(o,f){if(o)c.push({missing:g});else{for(var v,p=0,S=c.length;p<S;p++)if(c[p].ok&&c[p].ok._rev===f._rev){v=!0;break}v||c.push({ok:f})}l--,l||r(null,c)})})};if(n.open_revs){if(n.open_revs==="all")this._getRevisionTree(e,function(c,l){if(c)return r(c);i=Wt(l).map(function(g){return g.rev}),a()});else if(Array.isArray(n.open_revs)){i=n.open_revs;for(var s=0;s<i.length;s++){var u=i[s];if(!ct(u))return r(G(We))}a()}else return r(G(Lt,"function_clause"));return}return this._get(e,n,(c,l)=>{if(c)return c.docId=e,r(c);var g=l.doc,o=l.metadata,f=l.ctx;if(n.conflicts){var v=Ht(o);v.length&&(g._conflicts=v)}if(qe(o,g._rev)&&(g._deleted=!0),n.revs||n.revs_info){for(var p=g._rev.split("-"),S=parseInt(p[0],10),_=p[1],d=Fn(o.rev_tree),m=null,y=0;y<d.length;y++){var O=d[y];const $=O.ids.findIndex(L=>L.id===_);var q=$===S-1;(q||!m&&$!==-1)&&(m=O)}if(!m)return c=new Error("invalid rev tree"),c.docId=e,r(c);const j=g._rev.split("-")[1],U=m.ids.findIndex($=>$.id===j)+1;var x=m.ids.length-U;if(m.ids.splice(U,x),m.ids.reverse(),n.revs&&(g._revisions={start:m.pos+m.ids.length-1,ids:m.ids.map(function($){return $.id})}),n.revs_info){var T=m.pos+m.ids.length;g._revs_info=m.ids.map(function($){return T--,{rev:T+"-"+$.id,status:$.opts.status}})}}if(n.attachments&&g._attachments){var P=g._attachments,C=Object.keys(P).length;if(C===0)return r(null,g);Object.keys(P).forEach(j=>{this._getAttachment(g._id,j,P[j],{binary:n.binary,metadata:o,ctx:f},function(U,$){var L=g._attachments[j];L.data=$,delete L.stub,delete L.length,--C||r(null,g)})})}else{if(g._attachments)for(var K in g._attachments)Object.prototype.hasOwnProperty.call(g._attachments,K)&&(g._attachments[K].stub=!0);r(null,g)}})}).bind(this),this.getAttachment=te("getAttachment",function(e,n,r,i){r instanceof Function&&(i=r,r={}),this._get(e,r,(a,s)=>{if(a)return i(a);if(s.doc._attachments&&s.doc._attachments[n])r.ctx=s.ctx,r.binary=!0,r.metadata=s.metadata,this._getAttachment(e,n,s.doc._attachments[n],r,i);else return i(G(de))})}).bind(this),this.allDocs=te("allDocs",function(e,n){if(typeof e=="function"&&(n=e,e={}),e.skip=typeof e.skip<"u"?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in e})[0];if(r){n(G(Ar,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!Se(this)&&(ri(e),e.keys.length===0))return this._allDocs({limit:0},n)}return this._allDocs(e,n)}).bind(this),this.close=te("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}).bind(this),this.info=te("info",function(e){this._info((n,r)=>{if(n)return e(n);r.db_name=r.db_name||this.name,r.auto_compaction=!!(this.auto_compaction&&!Se(this)),r.adapter=this.adapter,e(null,r)})}).bind(this),this.id=te("id",function(e){return this._id(e)}).bind(this),this.bulkDocs=te("bulkDocs",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(G(Sr));for(var i=0;i<e.docs.length;++i){const c=e.docs[i];if(ut(c))return r(G(st));if("_rev"in c&&!ct(c._rev))return r(G(We))}var a;if(e.docs.forEach(function(c){c._attachments&&Object.keys(c._attachments).forEach(function(l){a=a||ai(l),c._attachments[l].content_type||ve("warn","Attachment",l,"on document",c._id,"is missing content_type")})}),a)return r(G(tt,a));"new_edits"in n||("new_edits"in e?n.new_edits=e.new_edits:n.new_edits=!0);var s=this;!n.new_edits&&!Se(s)&&e.docs.sort(ti),ei(e.docs);var u=e.docs.map(function(c){return c._id});this._bulkDocs(e,n,function(c,l){if(c)return r(c);if(n.new_edits||(l=l.filter(function(f){return f.error})),!Se(s))for(var g=0,o=l.length;g<o;g++)l[g].id=l[g].id||u[g];r(null,l)})}).bind(this),this.registerDependentDatabase=te("registerDependentDatabase",function(e,n){var r=se(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(e,r);function a(s){return s.dependentDbs=s.dependentDbs||{},s.dependentDbs[e]?!1:(s.dependentDbs[e]=!0,s)}Xe(this,"_local/_pouch_dependentDbs",a).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=te("destroy",function(e,n){typeof e=="function"&&(n=e,e={});var r="use_prefix"in this?this.use_prefix:!0;const i=()=>{this._destroy(e,(a,s)=>{if(a)return n(a);this._destroyed=!0,this.emit("destroyed"),n(null,s||{ok:!0})})};if(Se(this))return i();this.get("_local/_pouch_dependentDbs",(a,s)=>{if(a)return a.status!==404?n(a):i();var u=s.dependentDbs,c=this.constructor,l=Object.keys(u).map(g=>{var o=r?g.replace(new RegExp("^"+c.prefix),""):g;return new c(o,this.__opts).destroy()});Promise.all(l).then(i,n)})}).bind(this)}_compact(e,n){var r={return_docs:!1,last_seq:e.last_seq||0,since:e.last_seq||0},i=[],a,s=0;const u=g=>{this.activeTasks.update(a,{completed_items:++s}),i.push(this.compactDocument(g.id,0))},c=g=>{this.activeTasks.remove(a,g),n(g)},l=g=>{var o=g.last_seq;Promise.all(i).then(()=>Xe(this,"_local/compaction",f=>!f.last_seq||f.last_seq<o?(f.last_seq=o,f):!1)).then(()=>{this.activeTasks.remove(a),n(null,{ok:!0})}).catch(c)};this.info().then(g=>{a=this.activeTasks.add({name:"database_compaction",total_items:g.update_seq-r.last_seq}),this.changes(r).on("change",u).on("complete",l).on("error",c)})}changes(e,n){return typeof e=="function"&&(n=e,e={}),e=e||{},e.return_docs="return_docs"in e?e.return_docs:!e.live,new Vr(this,e,n)}type(){return typeof this._type=="function"?this._type():this.adapter}}Jn.prototype.purge=te("_purge",function(t,e,n){if(typeof this._purge>"u")return n(G(Lt,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(t,(i,a)=>{if(i)return n(i);if(!a)return n(G(de));let s;try{s=Mr(a,e)}catch(u){return n(u.message||u)}r._purge(t,s,(u,c)=>{if(u)return n(u);ii(r,t,e).then(function(){return n(null,c)})})})});class oi{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()}fail(e){this.failed=e,this.execute()}ready(e){this.isReady=!0,this.db=e,this.execute()}addTask(e){this.queue.push(e),this.failed&&this.execute()}}function ui(t,e){var n=t.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=J.adapters,i=J.preferredAdapters,a=J.prefix,s=e.adapter;if(!s)for(var u=0;u<i.length;++u){if(s=i[u],s==="idb"&&"websql"in r&&Ye()&&localStorage["_pouch__websqldb_"+a+t]){ve("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var c=r[s],l=c&&"use_prefix"in c?c.use_prefix:!0;return{name:l?a+t:t,adapter:s}}function ci(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t}})}function zn(t,e){let n=function(...r){if(!(this instanceof n))return new n(...r);e.apply(this,r)};return ci(n,t),n}function fi(t){function e(r){t.removeListener("closed",n),r||t.constructor.emit("destroyed",t.name)}function n(){t.removeListener("destroyed",e),t.constructor.emit("unref",t)}t.once("destroyed",e),t.once("closed",n),t.constructor.emit("ref",t)}class sn extends Jn{constructor(e,n){super(),this._setup(e,n)}_setup(e,n){if(super._setup(),n=n||{},e&&typeof e=="object"&&(n=e,e=n.name,delete n.name),n.deterministic_revs===void 0&&(n.deterministic_revs=!0),this.__opts=n=se(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=J.prefix,typeof e!="string")throw new Error("Missing/invalid DB name");var r=(n.prefix||"")+e,i=ui(r,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=e,this._adapter=n.adapter,J.emit("debug",["adapter","Picked adapter: ",n.adapter]),!J.adapters[n.adapter]||!J.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!J.adapters[n.view_adapter]||!J.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new oi,this.adapter=n.adapter,J.adapters[n.adapter].call(this,n,a=>{if(a)return this.taskqueue.fail(a);fi(this),this.emit("created",this),J.emit("created",this.name),this.taskqueue.ready(this)})}}const J=zn(sn,function(t,e){sn.prototype._setup.call(this,t,e)});var Qn=fetch,je=Headers;class li{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(e){const n=$t();return this.tasks[n]={id:n,name:e.name,total_items:e.total_items,created_at:new Date().toJSON()},n}get(e){return this.tasks[e]}remove(e,n){return delete this.tasks[e],this.tasks}update(e,n){const r=this.tasks[e];if(typeof r<"u"){const i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:new Date().toJSON()};this.tasks[e]=i}return this.tasks}}J.adapters={};J.preferredAdapters=[];J.prefix="_pouch_";var on=new Ae;function di(t){Object.keys(Ae.prototype).forEach(function(n){typeof Ae.prototype[n]=="function"&&(t[n]=on[n].bind(on))});var e=t._destructionListeners=new Map;t.on("ref",function(r){e.has(r.name)||e.set(r.name,[]),e.get(r.name).push(r)}),t.on("unref",function(r){if(e.has(r.name)){var i=e.get(r.name),a=i.indexOf(r);a<0||(i.splice(a,1),i.length>1?e.set(r.name,i):e.delete(r.name))}}),t.on("destroyed",function(r){if(e.has(r)){var i=e.get(r);e.delete(r),i.forEach(function(a){a.emit("destroyed",!0)})}})}di(J);J.adapter=function(t,e,n){e.valid()&&(J.adapters[t]=e,n&&J.preferredAdapters.push(t))};J.plugin=function(t){if(typeof t=="function")t(J);else{if(typeof t!="object"||Object.keys(t).length===0)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){J.prototype[e]=t[e]})}return this.__defaults&&(J.__defaults=Object.assign({},this.__defaults)),J};J.defaults=function(t){let e=zn(J,function(n,r){r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Object.assign({},e.__defaults,r),J.call(this,n,r)});return e.preferredAdapters=J.preferredAdapters.slice(),Object.keys(J).forEach(function(n){n in e||(e[n]=J[n])}),e.__defaults=Object.assign({},this.__defaults,t),e};J.fetch=function(t,e){return Qn(t,e)};J.prototype.activeTasks=J.activeTasks=new li;var hi="9.0.0";function Yt(t,e){for(var n=t,r=0,i=e.length;r<i;r++){var a=e[r];if(n=n[a],!n)break}return n}function vi(t,e){return t<e?-1:t>e?1:0}function Xt(t){for(var e=[],n="",r=0,i=t.length;r<i;r++){var a=t[r];r>0&&t[r-1]==="\\"&&(a==="$"||a===".")?n=n.substring(0,n.length-1)+a:a==="."?(e.push(n),n=""):n+=a}return e.push(n),e}var _i=["$or","$nor","$not"];function Wn(t){return _i.indexOf(t)>-1}function Hn(t){return Object.keys(t)[0]}function gi(t){return t[Hn(t)]}function Ge(t){var e={},n={$or:!0,$nor:!0};return t.forEach(function(r){Object.keys(r).forEach(function(i){var a=r[i];if(typeof a!="object"&&(a={$eq:a}),Wn(i))if(a instanceof Array){if(n[i]){n[i]=!1,e[i]=a;return}var s=[];e[i].forEach(function(c){Object.keys(a).forEach(function(l){var g=a[l],o=Math.max(Object.keys(c).length,Object.keys(g).length),f=Ge([c,g]);Object.keys(f).length<=o||s.push(f)})}),e[i]=s}else e[i]=Ge([a]);else{var u=e[i]=e[i]||{};Object.keys(a).forEach(function(c){var l=a[c];if(c==="$gt"||c==="$gte")return mi(c,l,u);if(c==="$lt"||c==="$lte")return yi(c,l,u);if(c==="$ne")return pi(l,u);if(c==="$eq")return wi(l,u);if(c==="$regex")return bi(l,u);u[c]=l})}})}),e}function mi(t,e,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?t==="$gte"?e>n.$gte&&(n.$gte=e):e>=n.$gte&&(delete n.$gte,n.$gt=e):typeof n.$gt<"u"?t==="$gte"?e>n.$gt&&(delete n.$gt,n.$gte=e):e>n.$gt&&(n.$gt=e):n[t]=e)}function yi(t,e,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?t==="$lte"?e<n.$lte&&(n.$lte=e):e<=n.$lte&&(delete n.$lte,n.$lt=e):typeof n.$lt<"u"?t==="$lte"?e<n.$lt&&(delete n.$lt,n.$lte=e):e<n.$lt&&(n.$lt=e):n[t]=e)}function pi(t,e){"$ne"in e?e.$ne.push(t):e.$ne=[t]}function wi(t,e){delete e.$gt,delete e.$gte,delete e.$lt,delete e.$lte,delete e.$ne,e.$eq=t}function bi(t,e){"$regex"in e?e.$regex.push(t):e.$regex=[t]}function Yn(t){for(var e in t){if(Array.isArray(t))for(var n in t)t[n].$and&&(t[n]=Ge(t[n].$and));var r=t[e];typeof r=="object"&&Yn(r)}return t}function Xn(t,e){for(var n in t){n==="$and"&&(e=!0);var r=t[n];typeof r=="object"&&(e=Xn(r,e))}return e}function Si(t){var e=se(t);Xn(e,!1)&&(e=Yn(e),"$and"in e&&(e=Ge(e.$and))),["$or","$nor"].forEach(function(s){s in e&&e[s].forEach(function(u){for(var c=Object.keys(u),l=0;l<c.length;l++){var g=c[l],o=u[g];(typeof o!="object"||o===null)&&(u[g]={$eq:o})}})}),"$not"in e&&(e.$not=Ge([e.$not]));for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],a=e[i];(typeof a!="object"||a===null)&&(a={$eq:a}),e[i]=a}return kt(e),e}function kt(t){Object.keys(t).forEach(function(e){var n=t[e];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&kt(r)}):e==="$ne"?t.$ne=[n]:e==="$regex"?t.$regex=[n]:n&&typeof n=="object"&&kt(n)})}function ki(t,e,n){for(var r="",i=n-t.length;r.length<i;)r+=e;return r}function qi(t,e,n){var r=ki(t,e,n);return r+t}var Zn=-324,qt=3,At="";function ne(t,e){if(t===e)return 0;t=Be(t),e=Be(e);var n=Ot(t),r=Ot(e);if(n-r!==0)return n-r;switch(typeof t){case"number":return t-e;case"boolean":return t<e?-1:1;case"string":return xi(t,e)}return Array.isArray(t)?Ei(t,e):Ti(t,e)}function Be(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-1/0||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var r=0;r<n;r++)t[r]=Be(e[r])}else{if(t instanceof Date)return t.toJSON();if(t!==null){t={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=e[i];typeof a<"u"&&(t[i]=Be(a))}}}}return t}function Ai(t){if(t!==null)switch(typeof t){case"boolean":return t?1:0;case"number":return Pi(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),r=-1,i=n.length,a="";if(e)for(;++r<i;)a+=me(n[r]);else for(;++r<i;){var s=n[r];a+=me(s)+me(t[s])}return a}return""}function me(t){var e="\0";return t=Be(t),Ot(t)+At+Ai(t)+e}function Oi(t,e){var n=e,r,i=t[e]==="1";if(i)r=0,e++;else{var a=t[e]==="0";e++;var s="",u=t.substring(e,e+qt),c=parseInt(u,10)+Zn;for(a&&(c=-c),e+=qt;;){var l=t[e];if(l==="\0")break;s+=l,e++}s=s.split("."),s.length===1?r=parseInt(s,10):r=parseFloat(s[0]+"."+s[1]),a&&(r=r-10),c!==0&&(r=parseFloat(r+"e"+c))}return{num:r,length:e-n}}function Di(t,e){var n=t.pop();if(e.length){var r=e[e.length-1];n===r.element&&(e.pop(),r=e[e.length-1]);var i=r.element,a=r.index;if(Array.isArray(i))i.push(n);else if(a===t.length-2){var s=t.pop();i[s]=n}else t.push(n)}}function Ci(t){for(var e=[],n=[],r=0;;){var i=t[r++];if(i==="\0"){if(e.length===1)return e.pop();Di(e,n);continue}switch(i){case"1":e.push(null);break;case"2":e.push(t[r]==="1"),r++;break;case"3":var a=Oi(t,r);e.push(a.num),r+=a.length;break;case"4":for(var s="";;){var u=t[r];if(u==="\0")break;s+=u,r++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(s);break;case"5":var c={element:[],index:e.length};e.push(c.element),n.push(c);break;case"6":var l={element:{},index:e.length};e.push(l.element),n.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Ei(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=ne(t[r],e[r]);if(i!==0)return i}return t.length===e.length?0:t.length>e.length?1:-1}function xi(t,e){return t===e?0:t>e?1:-1}function Ti(t,e){for(var n=Object.keys(t),r=Object.keys(e),i=Math.min(n.length,r.length),a=0;a<i;a++){var s=ne(n[a],r[a]);if(s!==0||(s=ne(t[n[a]],e[r[a]]),s!==0))return s}return n.length===r.length?0:n.length>r.length?1:-1}function Ot(t){var e=["boolean","number","string","object"],n=e.indexOf(typeof t);if(~n)return t===null?1:Array.isArray(t)?5:n<3?n+2:n+3;if(Array.isArray(t))return 5}function Pi(t){if(t===0)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),r=t<0,i=r?"0":"2",a=(r?-n:n)-Zn,s=qi(a.toString(),"0",qt);i+=At+s;var u=Math.abs(parseFloat(e[0]));r&&(u=10-u);var c=u.toFixed(20);return c=c.replace(/\.?0+$/,""),i+=At+c,i}function Ri(t){function e(n){return t.map(function(r){var i=Hn(r),a=Xt(i),s=Yt(n,a);return s})}return function(n,r){var i=e(n.doc),a=e(r.doc),s=ne(i,a);return s!==0?s:vi(n.doc._id,r.doc._id)}}function Bi(t,e,n){if(t=t.filter(function(s){return $e(s.doc,e.selector,n)}),e.sort){var r=Ri(e.sort);t=t.sort(r),typeof e.sort[0]!="string"&&gi(e.sort[0])==="desc"&&(t=t.reverse())}if("limit"in e||"skip"in e){var i=e.skip||0,a=("limit"in e?e.limit:t.length)+i;t=t.slice(i,a)}return t}function $e(t,e,n){return n.every(function(r){var i=e[r],a=Xt(r),s=Yt(t,a);return Wn(r)?Ii(r,i,t):Ze(i,t,a,s)})}function Ze(t,e,n,r){return t?typeof t=="object"?Object.keys(t).every(function(i){var a=t[i];if(i.indexOf("$")===0)return un(i,e,a,n,r);var s=Xt(i);if(r===void 0&&typeof a!="object"&&s.length>0)return!1;var u=Yt(r,s);return typeof a=="object"?Ze(a,e,n,u):un("$eq",e,a,s,u)}):t===r:!0}function Ii(t,e,n){return t==="$or"?e.some(function(r){return $e(n,r,Object.keys(r))}):t==="$not"?!$e(n,e,Object.keys(e)):!e.find(function(r){return $e(n,r,Object.keys(r))})}function un(t,e,n,r,i){if(!fn[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return fn[t](e,n,r,i)}function Fe(t){return typeof t<"u"&&t!==null}function Oe(t){return typeof t<"u"}function ji(t,e){if(typeof t!="number"||parseInt(t,10)!==t)return!1;var n=e[0],r=e[1];return t%n===r}function cn(t,e){return e.some(function(n){return t instanceof Array?t.some(function(r){return ne(n,r)===0}):ne(n,t)===0})}function $i(t,e){return e.every(function(n){return t.some(function(r){return ne(n,r)===0})})}function Li(t,e){return t.length===e}function Ni(t,e){var n=new RegExp(e);return n.test(t)}function Ki(t,e){switch(e){case"null":return t===null;case"boolean":return typeof t=="boolean";case"number":return typeof t=="number";case"string":return typeof t=="string";case"array":return t instanceof Array;case"object":return{}.toString.call(t)==="[object Object]"}}var fn={$elemMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return $e(i,e,Object.keys(e))}):r.some(function(i){return Ze(e,t,n,i)})},$allMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return $e(i,e,Object.keys(e))}):r.every(function(i){return Ze(e,t,n,i)})},$eq:function(t,e,n,r){return Oe(r)&&ne(r,e)===0},$gte:function(t,e,n,r){return Oe(r)&&ne(r,e)>=0},$gt:function(t,e,n,r){return Oe(r)&&ne(r,e)>0},$lte:function(t,e,n,r){return Oe(r)&&ne(r,e)<=0},$lt:function(t,e,n,r){return Oe(r)&&ne(r,e)<0},$exists:function(t,e,n,r){return e?Oe(r):!Oe(r)},$mod:function(t,e,n,r){return Fe(r)&&ji(r,e)},$ne:function(t,e,n,r){return e.every(function(i){return ne(r,i)!==0})},$in:function(t,e,n,r){return Fe(r)&&cn(r,e)},$nin:function(t,e,n,r){return Fe(r)&&!cn(r,e)},$size:function(t,e,n,r){return Fe(r)&&Array.isArray(r)&&Li(r,e)},$all:function(t,e,n,r){return Array.isArray(r)&&$i(r,e)},$regex:function(t,e,n,r){return Fe(r)&&typeof r=="string"&&e.every(function(i){return Ni(r,i)})},$type:function(t,e,n,r){return Ki(r,e)}};function Fi(t,e){if(typeof e!="object")throw new Error("Selector error: expected a JSON object");e=Si(e);var n={doc:t},r=Bi([n],{selector:e},Object.keys(e));return r&&r.length===1}function Mi(t){return Ft(`"use strict";
return `+t+";",{})}function Gi(t){var e=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+t+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return Ft(e,{})}function Ui(t,e){if(t.selector&&t.filter&&t.filter!=="_selector"){var n=typeof t.filter=="string"?t.filter:"function";return e(new Error('selector invalid for filter "'+n+'"'))}e()}function Ji(t){t.view&&!t.filter&&(t.filter="_view"),t.selector&&!t.filter&&(t.filter="_selector"),t.filter&&typeof t.filter=="string"&&(t.filter==="_view"?t.view=en(t.view):t.filter=en(t.filter))}function zi(t,e){return e.filter&&typeof e.filter=="string"&&!e.doc_ids&&!Se(t.db)}function Qi(t,e){var n=e.complete;if(e.filter==="_view"){if(!e.view||typeof e.view!="string"){var r=G(tt,"`view` filter parameter not found or invalid.");return n(r)}var i=St(e.view);t.db.get("_design/"+i[0],function(s,u){if(t.isCancelled)return n(null,{status:"cancelled"});if(s)return n(Ne(s));var c=u&&u.views&&u.views[i[1]]&&u.views[i[1]].map;if(!c)return n(G(de,u.views?"missing json key: "+i[1]:"missing json key: views"));e.filter=Gi(c),t.doChanges(e)})}else if(e.selector)e.filter=function(s){return Fi(s,e.selector)},t.doChanges(e);else{var a=St(e.filter);t.db.get("_design/"+a[0],function(s,u){if(t.isCancelled)return n(null,{status:"cancelled"});if(s)return n(Ne(s));var c=u&&u.filters&&u.filters[a[1]];if(!c)return n(G(de,u&&u.filters?"missing json key: "+a[1]:"missing json key: filters"));e.filter=Mi(c),t.doChanges(e)})}}function Wi(t){t._changesFilterPlugin={validate:Ui,normalize:Ji,shouldFilter:zi,filter:Qi}}J.plugin(Wi);J.version=hi;function Hi(t,e,n){return new Promise(function(r){var i=Gt([""]);let a;{const s=n;a=t.objectStore(e).put(i,s)}a.onsuccess=function(){var s=navigator.userAgent.match(/Chrome\/(\d+)/),u=navigator.userAgent.match(/Edge\//);r(u||!s||parseInt(s[1],10)>=43)},a.onerror=t.onabort=function(s){s.preventDefault(),s.stopPropagation(),r(!1)}}).catch(function(){return!1})}function Vn(t){return t.reduce(function(e,n){return e[n]=!0,e},{})}var Yi=Vn(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Xi=Vn(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function ln(t){if(!/^\d+-/.test(t))return G(We);var e=t.indexOf("-"),n=t.substring(0,e),r=t.substring(e+1);return{prefix:parseInt(n,10),id:r}}function Zi(t,e){for(var n=t.start-t.ids.length+1,r=t.ids,i=[r[0],e,[]],a=1,s=r.length;a<s;a++)i=[r[a],{status:"missing"},[i]];return[{pos:n,ids:i}]}function er(t,e,n){n||(n={deterministic_revs:!0});var r,i,a,s={status:"available"};if(t._deleted&&(s.deleted=!0),e)if(t._id||(t._id=nt()),i=Kn(t,n.deterministic_revs),t._rev){if(a=ln(t._rev),a.error)return a;t._rev_tree=[{pos:a.prefix,ids:[a.id,{status:"missing"},[[i,s,[]]]]}],r=a.prefix+1}else t._rev_tree=[{pos:1,ids:[i,s,[]]}],r=1;else if(t._revisions&&(t._rev_tree=Zi(t._revisions,s),r=t._revisions.start,i=t._revisions.ids[0]),!t._rev_tree){if(a=ln(t._rev),a.error)return a;r=a.prefix,i=a.id,t._rev_tree=[{pos:r,ids:[i,s,[]]}]}In(t._id),t._rev=r+"-"+i;var u={metadata:{},data:{}};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var l=c[0]==="_";if(l&&!Yi[c]){var g=G(Vt,c);throw g.message=Vt.message+": "+c,g}else l&&!Xi[c]?u.metadata[c.slice(1)]=t[c]:u.data[c]=t[c]}return u}function Vi(t){try{return Mt(t)}catch{var e=G(Bn,"Attachment is not a valid base64 string");return{error:e}}}function ea(t,e,n){var r=Vi(t.data);if(r.error)return n(r.error);t.length=r.length,e==="blob"?t.data=Ut(r,t.content_type):e==="base64"?t.data=Je(r):t.data=r,Qt(r,function(i){t.digest="md5-"+i,n()})}function ta(t,e,n){Qt(t.data,function(r){t.digest="md5-"+r,t.length=t.data.size||t.data.length||0,e==="binary"?Ln(t.data,function(i){t.data=i,n()}):e==="base64"?zt(t.data,function(i){t.data=i,n()}):n()})}function na(t,e,n){if(t.stub)return n();typeof t.data=="string"?ea(t,e,n):ta(t,e,n)}function ra(t,e,n){if(!t.length)return n();var r=0,i;t.forEach(function(s){var u=s.data&&s.data._attachments?Object.keys(s.data._attachments):[],c=0;if(!u.length)return a();function l(o){i=o,c++,c===u.length&&a()}for(var g in s.data._attachments)Object.prototype.hasOwnProperty.call(s.data._attachments,g)&&na(s.data._attachments[g],e,l)});function a(){r++,t.length===r&&(i?n(i):n())}}function ia(t,e,n,r,i,a,s,u){if(Wr(e.rev_tree,n.metadata.rev)&&!u)return r[i]=n,a();var c=e.winningRev||Pe(e),l="deleted"in e?e.deleted:qe(e,c),g="deleted"in n.metadata?n.metadata.deleted:qe(n.metadata),o=/^1-/.test(n.metadata.rev);if(l&&!g&&u&&o){var f=n.data;f._rev=c,f._id=n.metadata.id,n=er(f,u)}var v=Gn(e.rev_tree,n.metadata.rev_tree[0],t),p=u&&(l&&g&&v.conflicts!=="new_leaf"||!l&&v.conflicts!=="new_leaf"||l&&!g&&v.conflicts==="new_branch");if(p){var S=G(Le);return r[i]=S,a()}var _=n.metadata.rev;n.metadata.rev_tree=v.tree,n.stemmedRevs=v.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var d=Pe(n.metadata),m=qe(n.metadata,d),y=l===m?0:l<m?-1:1,O;_===d?O=m:O=qe(n.metadata,_),s(n,d,m,O,!0,y,i,a)}function aa(t){return t.metadata.rev_tree[0].ids[1].status==="missing"}function sa(t,e,n,r,i,a,s,u,c){t=t||1e3;function l(S,_,d){var m=Pe(S.metadata),y=qe(S.metadata,m);if("was_delete"in u&&y)return a[_]=G(de,"deleted"),d();var O=g&&aa(S);if(O){var q=G(Le);return a[_]=q,d()}var x=y?0:1;s(S,m,y,y,!1,x,_,d)}var g=u.new_edits,o=new Map,f=0,v=e.length;function p(){++f===v&&c&&c()}e.forEach(function(S,_){if(S._id&&Te(S._id)){var d=S._deleted?"_removeLocal":"_putLocal";n[d](S,{ctx:i},function(y,O){a[_]=y||O,p()});return}var m=S.metadata.id;o.has(m)?(v--,o.get(m).push([S,_])):o.set(m,[[S,_]])}),o.forEach(function(S,_){var d=0;function m(){++d<S.length?y():p()}function y(){var O=S[d],q=O[0],x=O[1];if(r.has(_))ia(t,r.get(_),q,a,x,m,s,g);else{var T=Gn([],q.metadata.rev_tree[0],t);q.metadata.rev_tree=T.tree,q.stemmedRevs=T.stemmedRevs||[],l(q,x,m)}}y()})}var oa=5,ie="document-store",ue="by-sequence",he="attach-store",Ee="attach-seq-store",ce="meta-store",we="local-store",ft="detect-blob-support";function ua(t){try{return JSON.parse(t)}catch{return Cn.parse(t)}}function ca(t){try{return JSON.stringify(t)}catch{return Cn.stringify(t)}}function be(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(G(Nt,n,e.type))}}function Dt(t,e,n){return{data:ca(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function xe(t){if(!t)return null;var e=ua(t.data);return e.winningRev=t.winningRev,e.deleted=t.deletedOrLocal==="1",e.seq=t.seq,e}function Ve(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function tr(t,e,n,r){n?r(t?typeof t!="string"?t:Jt(t,e):Gt([""],{type:e})):t?typeof t!="string"?$n(t,function(i){r(Je(i))}):r(t):r("")}function nr(t,e,n,r){var i=Object.keys(t._attachments||{});if(!i.length)return r&&r();var a=0;function s(){++a===i.length&&r&&r()}function u(c,l){var g=c._attachments[l],o=g.digest,f=n.objectStore(he).get(o);f.onsuccess=function(v){g.body=v.target.result.body,s()}}i.forEach(function(c){e.attachments&&e.include_docs?u(t,c):(t._attachments[c].stub=!0,s())})}function Ct(t,e){return Promise.all(t.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var a=n.doc._attachments[i];if("body"in a){var s=a.body,u=a.content_type;return new Promise(function(c){tr(s,u,e,function(l){n.doc._attachments[i]=Object.assign(Ue(a,["digest","content_type"]),{data:l}),c()})})}}))}}))}function rr(t,e,n){var r=[],i=n.objectStore(ue),a=n.objectStore(he),s=n.objectStore(Ee),u=t.length;function c(){u--,u||l()}function l(){r.length&&r.forEach(function(g){var o=s.index("digestSeq").count(IDBKeyRange.bound(g+"::",g+"::",!1,!1));o.onsuccess=function(f){var v=f.target.result;v||a.delete(g)}})}t.forEach(function(g){var o=i.index("_doc_id_rev"),f=e+"::"+g;o.getKey(f).onsuccess=function(v){var p=v.target.result;if(typeof p!="number")return c();i.delete(p);var S=s.index("seq").openCursor(IDBKeyRange.only(p));S.onsuccess=function(_){var d=_.target.result;if(d){var m=d.value.digestSeq.split("::")[0];r.push(m),s.delete(d.primaryKey),d.continue()}else c()}}})}function ye(t,e,n){try{return{txn:t.transaction(e,n)}}catch(r){return{error:r}}}var Me=new pr;function fa(t,e,n,r,i,a){for(var s=e.docs,u,c,l,g,o,f,v,p,S=0,_=s.length;S<_;S++){var d=s[S];d._id&&Te(d._id)||(d=s[S]=er(d,n.new_edits,t),d.error&&!v&&(v=d))}if(v)return a(v);var m=!1,y=0,O=new Array(s.length),q=new Map,x=!1,T=r._meta.blobSupport?"blob":"base64";ra(s,T,function(k){if(k)return a(k);P()});function P(){var k=[ie,ue,he,we,Ee,ce],E=ye(i,k,"readwrite");if(E.error)return a(E.error);u=E.txn,u.onabort=be(a),u.ontimeout=be(a),u.oncomplete=$,c=u.objectStore(ie),l=u.objectStore(ue),g=u.objectStore(he),o=u.objectStore(Ee),f=u.objectStore(ce),f.get(ce).onsuccess=function(I){p=I.target.result,j()},z(function(I){if(I)return x=!0,a(I);U()})}function C(){m=!0,j()}function K(){sa(t.revs_limit,s,r,q,u,O,Q,n,C)}function j(){!p||!m||(p.docCount+=y,f.put(p))}function U(){if(!s.length)return;var k=0;function E(){++k===s.length&&K()}function I(B){var N=xe(B.target.result);N&&q.set(N.id,N),E()}for(var M=0,R=s.length;M<R;M++){var b=s[M];if(b._id&&Te(b._id)){E();continue}var A=c.get(b.metadata.id);A.onsuccess=I}}function $(){x||(Me.notify(r._meta.name),a(null,O))}function L(k,E){var I=g.get(k);I.onsuccess=function(M){if(M.target.result)E();else{var R=G(Or,"unknown stub attachment with digest "+k);R.status=412,E(R)}}}function z(k){var E=[];if(s.forEach(function(b){b.data&&b.data._attachments&&Object.keys(b.data._attachments).forEach(function(A){var B=b.data._attachments[A];B.stub&&E.push(B.digest)})}),!E.length)return k();var I=0,M;function R(){++I===E.length&&k(M)}E.forEach(function(b){L(b,function(A){A&&!M&&(M=A),R()})})}function Q(k,E,I,M,R,b,A,B){k.metadata.winningRev=E,k.metadata.deleted=I;var N=k.data;N._id=k.metadata.id,N._rev=k.metadata.rev,M&&(N._deleted=!0);var F=N._attachments&&Object.keys(N._attachments).length;if(F)return h(k,E,I,R,A,B);y+=b,j(),W(k,E,I,R,A,B)}function W(k,E,I,M,R,b){var A=k.data,B=k.metadata;A._doc_id_rev=B.id+"::"+B.rev,delete A._id,delete A._rev;function N(re){var fe=k.stemmedRevs||[];M&&r.auto_compaction&&(fe=fe.concat(Fr(k.metadata))),fe&&fe.length&&rr(fe,k.metadata.id,u),B.seq=re.target.result;var pe=Dt(B,E,I),Y=c.put(pe);Y.onsuccess=X}function F(re){re.preventDefault(),re.stopPropagation();var fe=l.index("_doc_id_rev"),pe=fe.getKey(A._doc_id_rev);pe.onsuccess=function(Y){var H=l.put(A,Y.target.result);H.onsuccess=N}}function X(){O[R]={ok:!0,id:B.id,rev:B.rev},q.set(k.metadata.id,k.metadata),w(k,B.seq,b)}var ee=l.put(A);ee.onsuccess=N,ee.onerror=F}function h(k,E,I,M,R,b){var A=k.data,B=0,N=Object.keys(A._attachments);function F(){B===N.length&&W(k,E,I,M,R,b)}function X(){B++,F()}N.forEach(function(ee){var re=k.data._attachments[ee];if(re.stub)B++,F();else{var fe=re.data;delete re.data,re.revpos=parseInt(E,10);var pe=re.digest;D(pe,fe,X)}})}function w(k,E,I){var M=0,R=Object.keys(k.data._attachments||{});if(!R.length)return I();function b(){++M===R.length&&I()}function A(N){var F=k.data._attachments[N].digest,X=o.put({seq:E,digestSeq:F+"::"+E});X.onsuccess=b,X.onerror=function(ee){ee.preventDefault(),ee.stopPropagation(),b()}}for(var B=0;B<R.length;B++)A(R[B])}function D(k,E,I){var M=g.count(k);M.onsuccess=function(R){var b=R.target.result;if(b)return I();var A={digest:k,body:E},B=g.put(A);B.onsuccess=I}}}function ir(t,e,n,r,i){r===-1&&(r=1e3);var a=typeof t.getAll=="function"&&typeof t.getAllKeys=="function"&&r>1&&!n,s,u,c;function l(v){u=v.target.result,s&&i(s,u,c)}function g(v){s=v.target.result,u&&i(s,u,c)}function o(){if(!s.length)return i();var v=s[s.length-1],p;if(e&&e.upper)try{p=IDBKeyRange.bound(v,e.upper,!0,e.upperOpen)}catch(S){if(S.name==="DataError"&&S.code===0)return i()}else p=IDBKeyRange.lowerBound(v,!0);e=p,s=null,u=null,t.getAll(e,r).onsuccess=l,t.getAllKeys(e,r).onsuccess=g}function f(v){var p=v.target.result;if(!p)return i();i([p.key],[p.value],p)}a?(c={continue:o},t.getAll(e,r).onsuccess=l,t.getAllKeys(e,r).onsuccess=g):n?t.openCursor(e,"prev").onsuccess=f:t.openCursor(e).onsuccess=f}function la(t,e,n){if(typeof t.getAll=="function"){t.getAll(e).onsuccess=n;return}var r=[];function i(a){var s=a.target.result;s?(r.push(s.value),s.continue()):n({target:{result:r}})}t.openCursor(e).onsuccess=i}function da(t,e,n){var r=new Array(t.length),i=0;t.forEach(function(a,s){e.get(a).onsuccess=function(u){u.target.result?r[s]=u.target.result:r[s]={key:a,error:"not_found"},i++,i===t.length&&n(t,r,{})}})}function ha(t,e,n,r,i){try{if(t&&e)return i?IDBKeyRange.bound(e,t,!n,!1):IDBKeyRange.bound(t,e,!1,!n);if(t)return i?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return i?IDBKeyRange.lowerBound(e,!n):IDBKeyRange.upperBound(e,!n);if(r)return IDBKeyRange.only(r)}catch(a){return{error:a}}return null}function va(t,e,n){var r="startkey"in t?t.startkey:!1,i="endkey"in t?t.endkey:!1,a="key"in t?t.key:!1,s="keys"in t?t.keys:!1,u=t.skip||0,c=typeof t.limit=="number"?t.limit:-1,l=t.inclusive_end!==!1,g,o;if(!s&&(g=ha(r,i,l,a,t.descending),o=g&&g.error,o&&!(o.name==="DataError"&&o.code===0)))return n(G(Nt,o.name,o.message));var f=[ie,ue,ce];t.attachments&&f.push(he);var v=ye(e,f,"readonly");if(v.error)return n(v.error);var p=v.txn;p.oncomplete=U,p.onabort=be(n);var S=p.objectStore(ie),_=p.objectStore(ue),d=p.objectStore(ce),m=_.index("_doc_id_rev"),y=[],O,q;d.get(ce).onsuccess=function($){O=$.target.result.docCount},t.update_seq&&(_.openKeyCursor(null,"prev").onsuccess=$=>{var L=$.target.result;L&&L.key&&(q=L.key)});function x($,L,z){var Q=$.id+"::"+z;m.get(Q).onsuccess=function(h){if(L.doc=Ve(h.target.result)||{},t.conflicts){var w=Ht($);w.length&&(L.doc._conflicts=w)}nr(L.doc,t,p)}}function T($,L){var z={id:L.id,key:L.id,value:{rev:$}},Q=L.deleted;Q?s&&(y.push(z),z.value.deleted=!0,z.doc=null):u--<=0&&(y.push(z),t.include_docs&&x(L,z,$))}function P($){for(var L=0,z=$.length;L<z&&y.length!==c;L++){var Q=$[L];if(Q.error&&s){y.push(Q);continue}var W=xe(Q),h=W.winningRev;T(h,W)}}function C($,L,z){z&&(P(L),y.length<c&&z.continue())}function K($){var L=$.target.result;t.descending&&(L=L.reverse()),P(L)}function j(){var $={total_rows:O,offset:t.skip,rows:y};t.update_seq&&q!==void 0&&($.update_seq=q),n(null,$)}function U(){t.attachments?Ct(y,t.binary).then(j):j()}if(!(o||c===0)){if(s)return da(s,S,C);if(c===-1)return la(S,g,K);ir(S,g,t.descending,c+u,C)}}function _a(t,e){var n=t.objectStore(ie).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){e(r.target.result)}}var Et=!1,xt=[];function ga(t,e,n,r){try{t(e,n)}catch(i){r.emit("error",i)}}function dn(){Et||!xt.length||(Et=!0,xt.shift()())}function ma(t,e,n){xt.push(function(){t(function(a,s){ga(e,a,s,n),Et=!1,ke(function(){dn()})})}),dn()}function ya(t,e,n,r){if(t=se(t),t.continuous){var i=n+":"+nt();return Me.addListener(n,i,e,t),Me.notify(n),{cancel:function(){Me.removeListener(n,i)}}}var a=t.doc_ids&&new Set(t.doc_ids);t.since=t.since||0;var s=t.since,u="limit"in t?t.limit:-1;u===0&&(u=1);var c=[],l=0,g=Kt(t),o=new Map,f,v,p,S;function _(P,C,K){if(!K||!P.length)return;var j=new Array(P.length),U=new Array(P.length);function $(Q,W){var h=t.processChange(W,Q,t);s=h.seq=Q.seq;var w=g(h);return typeof w=="object"?Promise.reject(w):w?(l++,t.return_docs&&c.push(h),t.attachments&&t.include_docs?new Promise(function(D){nr(W,t,f,function(){Ct([h],t.binary).then(function(){D(h)})})}):Promise.resolve(h)):Promise.resolve()}function L(){for(var Q=[],W=0,h=j.length;W<h&&l!==u;W++){var w=j[W];if(w){var D=U[W];Q.push($(D,w))}}Promise.all(Q).then(function(k){for(var E=0,I=k.length;E<I;E++)k[E]&&t.onChange(k[E])}).catch(t.complete),l!==u&&K.continue()}var z=0;C.forEach(function(Q,W){var h=Ve(Q),w=P[W];m(h,w,function(D,k){U[W]=D,j[W]=k,++z===P.length&&L()})})}function d(P,C,K,j){if(K.seq!==C)return j();if(K.winningRev===P._rev)return j(K,P);var U=P._id+"::"+K.winningRev,$=S.get(U);$.onsuccess=function(L){j(K,Ve(L.target.result))}}function m(P,C,K){if(a&&!a.has(P._id))return K();var j=o.get(P._id);if(j)return d(P,C,j,K);p.get(P._id).onsuccess=function(U){j=xe(U.target.result),o.set(P._id,j),d(P,C,j,K)}}function y(){t.complete(null,{results:c,last_seq:s})}function O(){!t.continuous&&t.attachments?Ct(c).then(y):y()}var q=[ie,ue];t.attachments&&q.push(he);var x=ye(r,q,"readonly");if(x.error)return t.complete(x.error);f=x.txn,f.onabort=be(t.complete),f.oncomplete=O,v=f.objectStore(ue),p=f.objectStore(ie),S=v.index("_doc_id_rev");var T=t.since&&!t.descending?IDBKeyRange.lowerBound(t.since,!0):null;ir(v,T,t.descending,u,_)}var Ie=new Map,lt,dt=new Map;function ar(t,e){var n=this;ma(function(r){pa(n,t,r)},e,n.constructor)}function pa(t,e,n){var r=e.name,i=null,a=null;t._meta=null;function s(_){return function(d,m){d&&d instanceof Error&&!d.reason&&a&&(d.reason=a),_(d,m)}}function u(_){var d=_.createObjectStore(ie,{keyPath:"id"});_.createObjectStore(ue,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),_.createObjectStore(he,{keyPath:"digest"}),_.createObjectStore(ce,{keyPath:"id",autoIncrement:!1}),_.createObjectStore(ft),d.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),_.createObjectStore(we,{keyPath:"_id"});var m=_.createObjectStore(Ee,{autoIncrement:!0});m.createIndex("seq","seq"),m.createIndex("digestSeq","digestSeq",{unique:!0})}function c(_,d){var m=_.objectStore(ie);m.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),m.openCursor().onsuccess=function(y){var O=y.target.result;if(O){var q=O.value,x=qe(q);q.deletedOrLocal=x?"1":"0",m.put(q),O.continue()}else d()}}function l(_){_.createObjectStore(we,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function g(_,d){var m=_.objectStore(we),y=_.objectStore(ie),O=_.objectStore(ue),q=y.openCursor();q.onsuccess=function(x){var T=x.target.result;if(T){var P=T.value,C=P.id,K=Te(C),j=Pe(P);if(K){var U=C+"::"+j,$=C+"::",L=C+"::~",z=O.index("_doc_id_rev"),Q=IDBKeyRange.bound($,L,!1,!1),W=z.openCursor(Q);W.onsuccess=function(h){if(W=h.target.result,!W)y.delete(T.primaryKey),T.continue();else{var w=W.value;w._doc_id_rev===U&&m.put(w),O.delete(W.primaryKey),W.continue()}}}else T.continue()}else d&&d()}}function o(_){var d=_.createObjectStore(Ee,{autoIncrement:!0});d.createIndex("seq","seq"),d.createIndex("digestSeq","digestSeq",{unique:!0})}function f(_,d){var m=_.objectStore(ue),y=_.objectStore(he),O=_.objectStore(Ee),q=y.count();q.onsuccess=function(x){var T=x.target.result;if(!T)return d();m.openCursor().onsuccess=function(P){var C=P.target.result;if(!C)return d();for(var K=C.value,j=C.primaryKey,U=Object.keys(K._attachments||{}),$={},L=0;L<U.length;L++){var z=K._attachments[U[L]];$[z.digest]=!0}var Q=Object.keys($);for(L=0;L<Q.length;L++){var W=Q[L];O.put({seq:j,digestSeq:W+"::"+j})}C.continue()}}}function v(_){function d(q){return q.data?xe(q):(q.deleted=q.deletedOrLocal==="1",q)}var m=_.objectStore(ue),y=_.objectStore(ie),O=y.openCursor();O.onsuccess=function(q){var x=q.target.result;if(!x)return;var T=d(x.value);T.winningRev=T.winningRev||Pe(T);function P(){var K=T.id+"::",j=T.id+"::",U=m.index("_doc_id_rev").openCursor(IDBKeyRange.bound(K,j)),$=0;U.onsuccess=function(L){var z=L.target.result;if(!z)return T.seq=$,C();var Q=z.primaryKey;Q>$&&($=Q),z.continue()}}function C(){var K=Dt(T,T.winningRev,T.deleted),j=y.put(K);j.onsuccess=function(){x.continue()}}if(T.seq)return C();P()}}t._remote=!1,t.type=function(){return"idb"},t._id=Tn(function(_){_(null,t._meta.instanceId)}),t._bulkDocs=function(d,m,y){fa(e,d,m,t,i,s(y))},t._get=function(d,m,y){var O,q,x,T=m.ctx;if(!T){var P=ye(i,[ie,ue,he],"readonly");if(P.error)return y(P.error);T=P.txn}function C(){y(x,{doc:O,metadata:q,ctx:T})}T.objectStore(ie).get(d).onsuccess=function(K){if(q=xe(K.target.result),!q)return x=G(de,"missing"),C();var j;if(m.rev)j=m.latest?Yr(m.rev,q):m.rev;else{j=q.winningRev;var U=qe(q);if(U)return x=G(de,"deleted"),C()}var $=T.objectStore(ue),L=q.id+"::"+j;$.index("_doc_id_rev").get(L).onsuccess=function(z){if(O=z.target.result,O&&(O=Ve(O)),!O)return x=G(de,"missing"),C();C()}}},t._getAttachment=function(_,d,m,y,O){var q;if(y.ctx)q=y.ctx;else{var x=ye(i,[ie,ue,he],"readonly");if(x.error)return O(x.error);q=x.txn}var T=m.digest,P=m.content_type;q.objectStore(he).get(T).onsuccess=function(C){var K=C.target.result.body;tr(K,P,y.binary,function(j){O(null,j)})}},t._info=function(d){var m,y,O=ye(i,[ce,ue],"readonly");if(O.error)return d(O.error);var q=O.txn;q.objectStore(ce).get(ce).onsuccess=function(x){y=x.target.result.docCount},q.objectStore(ue).openKeyCursor(null,"prev").onsuccess=function(x){var T=x.target.result;m=T?T.key:0},q.oncomplete=function(){d(null,{doc_count:y,update_seq:m,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(d,m){va(d,i,s(m))},t._changes=function(d){return ya(d,t,r,i)},t._close=function(_){i.close(),Ie.delete(r),_()},t._getRevisionTree=function(_,d){var m=ye(i,[ie],"readonly");if(m.error)return d(m.error);var y=m.txn,O=y.objectStore(ie).get(_);O.onsuccess=function(q){var x=xe(q.target.result);x?d(null,x.rev_tree):d(G(de))}},t._doCompaction=function(_,d,m){var y=[ie,ue,he,Ee],O=ye(i,y,"readwrite");if(O.error)return m(O.error);var q=O.txn,x=q.objectStore(ie);x.get(_).onsuccess=function(T){var P=xe(T.target.result);Re(P.rev_tree,function(j,U,$,L,z){var Q=U+"-"+$;d.indexOf(Q)!==-1&&(z.status="missing")}),rr(d,_,q);var C=P.winningRev,K=P.deleted;q.objectStore(ie).put(Dt(P,C,K))},q.onabort=be(m),q.oncomplete=function(){m()}},t._getLocal=function(_,d){var m=ye(i,[we],"readonly");if(m.error)return d(m.error);var y=m.txn,O=y.objectStore(we).get(_);O.onerror=be(d),O.onsuccess=function(q){var x=q.target.result;x?(delete x._doc_id_rev,d(null,x)):d(G(de))}},t._putLocal=function(_,d,m){typeof d=="function"&&(m=d,d={}),delete _._revisions;var y=_._rev,O=_._id;y?_._rev="0-"+(parseInt(y.split("-")[1],10)+1):_._rev="0-1";var q=d.ctx,x;if(!q){var T=ye(i,[we],"readwrite");if(T.error)return m(T.error);q=T.txn,q.onerror=be(m),q.oncomplete=function(){x&&m(null,x)}}var P=q.objectStore(we),C;y?(C=P.get(O),C.onsuccess=function(K){var j=K.target.result;if(!j||j._rev!==y)m(G(Le));else{var U=P.put(_);U.onsuccess=function(){x={ok:!0,id:_._id,rev:_._rev},d.ctx&&m(null,x)}}}):(C=P.add(_),C.onerror=function(K){m(G(Le)),K.preventDefault(),K.stopPropagation()},C.onsuccess=function(){x={ok:!0,id:_._id,rev:_._rev},d.ctx&&m(null,x)})},t._removeLocal=function(_,d,m){typeof d=="function"&&(m=d,d={});var y=d.ctx;if(!y){var O=ye(i,[we],"readwrite");if(O.error)return m(O.error);y=O.txn,y.oncomplete=function(){q&&m(null,q)}}var q,x=_._id,T=y.objectStore(we),P=T.get(x);P.onerror=be(m),P.onsuccess=function(C){var K=C.target.result;!K||K._rev!==_._rev?m(G(de)):(T.delete(x),q={ok:!0,id:x,rev:"0-0"},d.ctx&&m(null,q))}},t._destroy=function(_,d){Me.removeAllListeners(r);var m=dt.get(r);m&&m.result&&(m.result.close(),Ie.delete(r));var y=indexedDB.deleteDatabase(r);y.onsuccess=function(){dt.delete(r),Ye()&&r in localStorage&&delete localStorage[r],d(null,{ok:!0})},y.onerror=be(d)};var p=Ie.get(r);if(p)return i=p.idb,t._meta=p.global,ke(function(){n(null,t)});var S=indexedDB.open(r,oa);dt.set(r,S),S.onupgradeneeded=function(_){var d=_.target.result;if(_.oldVersion<1)return u(d);var m=_.currentTarget.transaction;_.oldVersion<3&&l(d),_.oldVersion<4&&o(d);var y=[c,g,f,v],O=_.oldVersion;function q(){var x=y[O-1];O++,x&&x(m,q)}q()},S.onsuccess=function(_){i=_.target.result,i.onversionchange=function(){i.close(),Ie.delete(r)},i.onabort=function(C){ve("error","Database has a global failure",C.target.error),a=C.target.error,i.close(),Ie.delete(r)};var d=i.transaction([ce,ft,ie],"readwrite"),m=!1,y,O,q,x;function T(){typeof q>"u"||!m||(t._meta={name:r,instanceId:x,blobSupport:q},Ie.set(r,{idb:i,global:t._meta}),n(null,t))}function P(){if(!(typeof O>"u"||typeof y>"u")){var C=r+"_id";C in y?x=y[C]:y[C]=x=nt(),y.docCount=O,d.objectStore(ce).put(y)}}d.objectStore(ce).get(ce).onsuccess=function(C){y=C.target.result||{id:ce},P()},_a(d,function(C){O=C,P()}),lt||(lt=Hi(d,ft,"key")),lt.then(function(C){q=C,T()}),d.oncomplete=function(){m=!0,T()},d.onabort=be(n)},S.onerror=function(_){var d=_.target.error&&_.target.error.message;d?d.indexOf("stored database is a higher version")!==-1&&(d=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):d="Failed to open indexedDB, are you in private browsing mode?",ve("error",d),n(G(Nt,d))}}ar.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};function wa(t){t.adapter("idb",ar,!0)}function ba(t,e){return new Promise(function(n,r){var i=0,a=0,s=0,u=t.length,c;function l(){i++,t[a++]().then(o,f)}function g(){++s===u?c?r(c):n():v()}function o(){i--,g()}function f(p){i--,c=c||p,g()}function v(){for(;i<e&&a<u;)l()}v()})}const Sa=25,ka=50,ze=5e3,qa=1e4,ht={};function vt(t){const e=t.doc||t.ok,n=e&&e._attachments;n&&Object.keys(n).forEach(function(r){const i=n[r];i.data=Jt(i.data,i.content_type)})}function De(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):t.startsWith("_local/")?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function hn(t){return!t._attachments||!Object.keys(t._attachments)?Promise.resolve():Promise.all(Object.keys(t._attachments).map(function(e){const n=t._attachments[e];if(n.data&&typeof n.data!="string")return new Promise(function(r){zt(n.data,r)}).then(function(r){n.data=r})}))}function Aa(t){if(!t.prefix)return!1;const e=jn(t.prefix).protocol;return e==="http"||e==="https"}function Oa(t,e){if(Aa(e)){const i=e.name.substr(e.prefix.length);t=e.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}const n=jn(t);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});const r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),n.db.indexOf("%")===-1&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function ae(t,e){return He(t,t.db+"/"+e)}function He(t,e){const n=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+n+e}function Qe(t){const e=Object.keys(t);return e.length===0?"":"?"+e.map(n=>n+"="+encodeURIComponent(t[n])).join("&")}function Da(t){const e=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=e.indexOf("msie")!==-1,r=e.indexOf("trident")!==-1,i=e.indexOf("edge")!==-1,a=!("method"in t)||t.method==="GET";return(n||r||i)&&a}function Tt(t,e){const n=this,r=Oa(t.name,t),i=ae(r,"");t=se(t);const a=async function(o,f){if(f=f||{},f.headers=f.headers||new je,f.credentials="include",t.auth||r.auth){const S=t.auth||r.auth,_=S.username+":"+S.password,d=Je(unescape(encodeURIComponent(_)));f.headers.set("Authorization","Basic "+d)}const v=t.headers||{};return Object.keys(v).forEach(function(S){f.headers.append(S,v[S])}),Da(f)&&(o+=(o.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()),await(t.fetch||Qn)(o,f)};function s(o,f){return te(o,function(...v){l().then(function(){return f.apply(this,v)}).catch(function(p){v.pop()(p)})}).bind(n)}async function u(o,f){const v={};f=f||{},f.headers=f.headers||new je,f.headers.get("Content-Type")||f.headers.set("Content-Type","application/json"),f.headers.get("Accept")||f.headers.set("Accept","application/json");const p=await a(o,f);v.ok=p.ok,v.status=p.status;const S=await p.json();if(v.data=S,!v.ok)throw v.data.status=v.status,Ne(v.data);return Array.isArray(v.data)&&(v.data=v.data.map(function(_){return _.error||_.missing?Ne(_):_})),v}let c;async function l(){return t.skip_setup?Promise.resolve():c||(c=u(i).catch(function(o){return o&&o.status&&o.status===404?(bt(404,"PouchDB is just detecting if the remote exists."),u(i,{method:"PUT"})):Promise.reject(o)}).catch(function(o){return o&&o.status&&o.status===412?!0:Promise.reject(o)}),c.catch(function(){c=null}),c)}ke(function(){e(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=s("id",async function(o){let f;try{f=await(await a(He(r,""))).json()}catch{f={}}const v=f&&f.uuid?f.uuid+r.db:ae(r,"");o(null,v)}),n.compact=s("compact",async function(o,f){typeof o=="function"&&(f=o,o={}),o=se(o),await u(ae(r,"_compact"),{method:"POST"});function v(){n.info(function(p,S){S&&!S.compact_running?f(null,{ok:!0}):setTimeout(v,o.interval||200)})}v()}),n.bulkGet=te("bulkGet",function(o,f){const v=this;async function p(m){const y={};o.revs&&(y.revs=!0),o.attachments&&(y.attachments=!0),o.latest&&(y.latest=!0);try{const O=await u(ae(r,"_bulk_get"+Qe(y)),{method:"POST",body:JSON.stringify({docs:o.docs})});o.attachments&&o.binary&&O.data.results.forEach(function(q){q.docs.forEach(vt)}),m(null,O.data)}catch(O){m(O)}}function S(){const m=ka,y=Math.ceil(o.docs.length/m);let O=0;const q=new Array(y);function x(T){return function(P,C){q[T]=C.results,++O===y&&f(null,{results:q.flat()})}}for(let T=0;T<y;T++){const P=Ue(o,["revs","attachments","binary","latest"]);P.docs=o.docs.slice(T*m,Math.min(o.docs.length,(T+1)*m)),Pn(v,P,x(T))}}const _=He(r,""),d=ht[_];typeof d!="boolean"?p(function(m,y){m?(ht[_]=!1,bt(m.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),S()):(ht[_]=!0,f(null,y))}):d?p(f):S()}),n._info=async function(o){try{await l();const v=await(await a(ae(r,""))).json();v.host=ae(r,""),o(null,v)}catch(f){o(f)}},n.fetch=async function(o,f){await l();const v=o.substring(0,1)==="/"?He(r,o.substring(1)):ae(r,o);return a(v,f)},n.get=s("get",async function(o,f,v){typeof f=="function"&&(v=f,f={}),f=se(f);const p={};f.revs&&(p.revs=!0),f.revs_info&&(p.revs_info=!0),f.latest&&(p.latest=!0),f.open_revs&&(f.open_revs!=="all"&&(f.open_revs=JSON.stringify(f.open_revs)),p.open_revs=f.open_revs),f.rev&&(p.rev=f.rev),f.conflicts&&(p.conflicts=f.conflicts),f.update_seq&&(p.update_seq=f.update_seq),o=De(o);function S(m){const y=m._attachments,O=y&&Object.keys(y);if(!y||!O.length)return;async function q(T){const P=y[T],C=De(m._id)+"/"+g(T)+"?rev="+m._rev,K=await a(ae(r,C));let j;"buffer"in K?j=await K.buffer():j=await K.blob();let U;if(f.binary){const $=Object.getOwnPropertyDescriptor(j.__proto__,"type");(!$||$.set)&&(j.type=P.content_type),U=j}else U=await new Promise(function($){zt(j,$)});delete P.stub,delete P.length,P.data=U}const x=O.map(function(T){return function(){return q(T)}});return ba(x,5)}function _(m){return Array.isArray(m)?Promise.all(m.map(function(y){if(y.ok)return S(y.ok)})):S(m)}const d=ae(r,o+Qe(p));try{const m=await u(d);f.attachments&&await _(m.data),v(null,m.data)}catch(m){m.docId=o,v(m)}}),n.remove=s("remove",async function(o,f,v,p){let S;typeof f=="string"?(S={_id:o,_rev:f},typeof v=="function"&&(p=v,v={})):(S=o,typeof f=="function"?(p=f,v={}):(p=v,v=f));const _=S._rev||v.rev,d=ae(r,De(S._id))+"?rev="+_;try{const m=await u(d,{method:"DELETE"});p(null,m.data)}catch(m){p(m)}});function g(o){return o.split("/").map(encodeURIComponent).join("/")}n.getAttachment=s("getAttachment",async function(o,f,v,p){typeof v=="function"&&(p=v,v={});const S=v.rev?"?rev="+v.rev:"",_=ae(r,De(o))+"/"+g(f)+S;let d;try{const m=await a(_,{method:"GET"});if(!m.ok)throw m;d=m.headers.get("content-type");let y;if(typeof process<"u"&&!process.browser&&typeof m.buffer=="function"?y=await m.buffer():y=await m.blob(),typeof process<"u"&&!process.browser){const O=Object.getOwnPropertyDescriptor(y.__proto__,"type");(!O||O.set)&&(y.type=d)}p(null,y)}catch(m){p(m)}}),n.removeAttachment=s("removeAttachment",async function(o,f,v,p){const S=ae(r,De(o)+"/"+g(f))+"?rev="+v;try{const _=await u(S,{method:"DELETE"});p(null,_.data)}catch(_){p(_)}}),n.putAttachment=s("putAttachment",async function(o,f,v,p,S,_){typeof S=="function"&&(_=S,S=p,p=v,v=null);const d=De(o)+"/"+g(f);let m=ae(r,d);if(v&&(m+="?rev="+v),typeof p=="string"){let y;try{y=Mt(p)}catch{return _(G(Bn,"Attachment is not a valid base64 string"))}p=y?Ut(y,S):""}try{const y=await u(m,{headers:new je({"Content-Type":S}),method:"PUT",body:p});_(null,y.data)}catch(y){_(y)}}),n._bulkDocs=async function(o,f,v){o.new_edits=f.new_edits;try{await l(),await Promise.all(o.docs.map(hn));const p=await u(ae(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(o)});v(null,p.data)}catch(p){v(p)}},n._put=async function(o,f,v){try{await l(),await hn(o);const p=await u(ae(r,De(o._id)),{method:"PUT",body:JSON.stringify(o)});v(null,p.data)}catch(p){p.docId=o&&o._id,v(p)}},n.allDocs=s("allDocs",async function(o,f){typeof o=="function"&&(f=o,o={}),o=se(o);const v={};let p,S="GET";o.conflicts&&(v.conflicts=!0),o.update_seq&&(v.update_seq=!0),o.descending&&(v.descending=!0),o.include_docs&&(v.include_docs=!0),o.attachments&&(v.attachments=!0),o.key&&(v.key=JSON.stringify(o.key)),o.start_key&&(o.startkey=o.start_key),o.startkey&&(v.startkey=JSON.stringify(o.startkey)),o.end_key&&(o.endkey=o.end_key),o.endkey&&(v.endkey=JSON.stringify(o.endkey)),typeof o.inclusive_end<"u"&&(v.inclusive_end=!!o.inclusive_end),typeof o.limit<"u"&&(v.limit=o.limit),typeof o.skip<"u"&&(v.skip=o.skip);const _=Qe(v);typeof o.keys<"u"&&(S="POST",p={keys:o.keys});try{const d=await u(ae(r,"_all_docs"+_),{method:S,body:JSON.stringify(p)});o.include_docs&&o.attachments&&o.binary&&d.data.rows.forEach(vt),f(null,d.data)}catch(d){f(d)}}),n._changes=function(o){const f="batch_size"in o?o.batch_size:Sa;o=se(o),o.continuous&&!("heartbeat"in o)&&(o.heartbeat=qa);let v="timeout"in o?o.timeout:30*1e3;"timeout"in o&&o.timeout&&v-o.timeout<ze&&(v=o.timeout+ze),"heartbeat"in o&&o.heartbeat&&v-o.heartbeat<ze&&(v=o.heartbeat+ze);const p={};"timeout"in o&&o.timeout&&(p.timeout=o.timeout);const S=typeof o.limit<"u"?o.limit:!1;let _=S;if(o.style&&(p.style=o.style),(o.include_docs||o.filter&&typeof o.filter=="function")&&(p.include_docs=!0),o.attachments&&(p.attachments=!0),o.continuous&&(p.feed="longpoll"),o.seq_interval&&(p.seq_interval=o.seq_interval),o.conflicts&&(p.conflicts=!0),o.descending&&(p.descending=!0),o.update_seq&&(p.update_seq=!0),"heartbeat"in o&&o.heartbeat&&(p.heartbeat=o.heartbeat),o.filter&&typeof o.filter=="string"&&(p.filter=o.filter),o.view&&typeof o.view=="string"&&(p.filter="_view",p.view=o.view),o.query_params&&typeof o.query_params=="object")for(const P in o.query_params)Object.prototype.hasOwnProperty.call(o.query_params,P)&&(p[P]=o.query_params[P]);let d="GET",m;o.doc_ids?(p.filter="_doc_ids",d="POST",m={doc_ids:o.doc_ids}):o.selector&&(p.filter="_selector",d="POST",m={selector:o.selector});const y=new AbortController;let O;const q=async function(P,C){if(o.aborted)return;p.since=P,typeof p.since=="object"&&(p.since=JSON.stringify(p.since)),o.descending?S&&(p.limit=_):p.limit=!S||_>f?f:_;const K=ae(r,"_changes"+Qe(p)),j={signal:y.signal,method:d,body:JSON.stringify(m)};if(O=P,!o.aborted)try{await l();const U=await u(K,j);C(null,U.data)}catch(U){C(U)}},x={results:[]},T=function(P,C){if(o.aborted)return;let K=0;if(C&&C.results){K=C.results.length,x.last_seq=C.last_seq;let U=null,$=null;typeof C.pending=="number"&&(U=C.pending),(typeof x.last_seq=="string"||typeof x.last_seq=="number")&&($=x.last_seq),o.query_params,C.results=C.results.filter(function(L){_--;const z=Kt(o)(L);return z&&(o.include_docs&&o.attachments&&o.binary&&vt(L),o.return_docs&&x.results.push(L),o.onChange(L,U,$)),z})}else if(P){o.aborted=!0,o.complete(P);return}C&&C.last_seq&&(O=C.last_seq);const j=S&&_<=0||C&&K<f||o.descending;o.continuous&&!(S&&_<=0)||!j?ke(function(){q(O,T)}):o.complete(null,x)};return q(o.since||0,T),{cancel:function(){o.aborted=!0,y.abort()}}},n.revsDiff=s("revsDiff",async function(o,f,v){typeof f=="function"&&(v=f,f={});try{const p=await u(ae(r,"_revs_diff"),{method:"POST",body:JSON.stringify(o)});v(null,p.data)}catch(p){v(p)}}),n._close=function(o){o()},n._destroy=async function(o,f){try{const v=await u(ae(r,""),{method:"DELETE"});f(null,v)}catch(v){v.status===404?f(null,{ok:!0}):f(v)}}}Tt.valid=function(){return!0};function Ca(t){t.adapter("http",Tt,!1),t.adapter("https",Tt,!1)}class Ce extends Error{constructor(e){super(),this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Ce)}catch{}}}class rt extends Error{constructor(e){super(),this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,rt)}catch{}}}class it extends Error{constructor(e){super(),this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,it)}catch{}}}function sr(t,e){return e&&t.then(function(n){ke(function(){e(null,n)})},function(n){ke(function(){e(n)})}),t}function Ea(t){return function(...e){var n=e.pop(),r=t.apply(this,e);return typeof n=="function"&&sr(r,n),r}}function xa(t,e){return t.then(function(n){return e().then(function(){return n})},function(n){return e().then(function(){throw n})})}function _t(t,e){return function(){var n=arguments,r=this;return t.add(function(){return e.apply(r,n)})}}function vn(t){var e=new Set(t),n=new Array(e.size),r=-1;return e.forEach(function(i){n[++r]=i}),n}function gt(t){var e=new Array(t.size),n=-1;return t.forEach(function(r,i){e[++n]=i}),e}function _n(t){var e="builtin "+t+" function requires map values to be numbers or number arrays";return new it(e)}function Pt(t){for(var e=0,n=0,r=t.length;n<r;n++){var i=t[n];if(typeof i!="number")if(Array.isArray(i)){e=typeof e=="number"?[e]:e;for(var a=0,s=i.length;a<s;a++){var u=i[a];if(typeof u!="number")throw _n("_sum");typeof e[a]>"u"?e.push(u):e[a]+=u}}else throw _n("_sum");else typeof e=="number"?e+=i:e[0]+=i}return e}var Ta=ve.bind(null,"log"),Pa=Array.isArray,Ra=JSON.parse;function or(t,e){return Ft("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:Pt,log:Ta,isArray:Pa,toJSON:Ra})}class Rt{constructor(){this.promise=Promise.resolve()}add(e){return this.promise=this.promise.catch(()=>{}).then(()=>e()),this.promise}finish(){return this.promise}}function gn(t){if(!t)return"undefined";switch(typeof t){case"function":return t.toString();case"string":return t.toString();default:return JSON.stringify(t)}}function Ba(t,e){return gn(t)+gn(e)+"undefined"}async function mn(t,e,n,r,i,a){const s=Ba(n,r);let u;if(!i&&(u=t._cachedViews=t._cachedViews||{},u[s]))return u[s];const c=t.info().then(async function(l){const g=l.db_name+"-mrview-"+(i?"temp":Nn(s));function o(_){_.views=_.views||{};let d=e;d.indexOf("/")===-1&&(d=e+"/"+e);const m=_.views[d]=_.views[d]||{};if(!m[g])return m[g]=!0,_}await Xe(t,"_local/"+a,o);const v=(await t.registerDependentDatabase(g)).db;v.auto_compaction=!0;const p={name:g,db:v,sourceDB:t,adapter:t.adapter,mapFun:n,reduceFun:r};let S;try{S=await p.db.get("_local/lastSeq")}catch(_){if(_.status!==404)throw _}return p.seq=S?S.seq:0,u&&p.db.once("destroyed",function(){delete u[s]}),p});return u&&(u[s]=c),c}const yn={},pn=new Rt,Ia=50;function mt(t){return t.indexOf("/")===-1?[t,t]:t.split("/")}function ja(t){return t.length===1&&/^1-/.test(t[0].rev)}function wn(t,e,n){try{t.emit("error",e)}catch{ve("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),ve("error",e,n)}}function $a(t,e,n,r){function i(h,w,D){try{w(D)}catch(k){wn(h,k,{fun:w,doc:D})}}function a(h,w,D,k,E){try{return{output:w(D,k,E)}}catch(I){return wn(h,I,{fun:w,keys:D,values:k,rereduce:E}),{error:I}}}function s(h,w){const D=ne(h.key,w.key);return D!==0?D:ne(h.value,w.value)}function u(h,w,D){return D=D||0,typeof w=="number"?h.slice(D,w+D):D>0?h.slice(D):h}function c(h){const w=h.value;return w&&typeof w=="object"&&w._id||h.id}function l(h){for(const w of h.rows){const D=w.doc&&w.doc._attachments;if(D)for(const k of Object.keys(D)){const E=D[k];D[k].data=Jt(E.data,E.content_type)}}}function g(h){return function(w){return h.include_docs&&h.attachments&&h.binary&&l(w),w}}function o(h,w,D,k){let E=w[h];typeof E<"u"&&(k&&(E=encodeURIComponent(JSON.stringify(E))),D.push(h+"="+E))}function f(h){if(typeof h<"u"){const w=Number(h);return!isNaN(w)&&w===parseInt(h,10)?w:h}}function v(h){return h.group_level=f(h.group_level),h.limit=f(h.limit),h.skip=f(h.skip),h}function p(h){if(h){if(typeof h!="number")return new Ce(`Invalid value for integer: "${h}"`);if(h<0)return new Ce(`Invalid value for positive integer: "${h}"`)}}function S(h,w){const D=h.descending?"endkey":"startkey",k=h.descending?"startkey":"endkey";if(typeof h[D]<"u"&&typeof h[k]<"u"&&ne(h[D],h[k])>0)throw new Ce("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(w.reduce&&h.reduce!==!1){if(h.include_docs)throw new Ce("{include_docs:true} is invalid for reduce");if(h.keys&&h.keys.length>1&&!h.group&&!h.group_level)throw new Ce("Multi-key fetches for reduce views must use {group: true}")}for(const E of["group_level","limit","skip"]){const I=p(h[E]);if(I)throw I}}async function _(h,w,D){let k=[],E,I="GET",M;if(o("reduce",D,k),o("include_docs",D,k),o("attachments",D,k),o("limit",D,k),o("descending",D,k),o("group",D,k),o("group_level",D,k),o("skip",D,k),o("stale",D,k),o("conflicts",D,k),o("startkey",D,k,!0),o("start_key",D,k,!0),o("endkey",D,k,!0),o("end_key",D,k,!0),o("inclusive_end",D,k),o("key",D,k,!0),o("update_seq",D,k),k=k.join("&"),k=k===""?"":"?"+k,typeof D.keys<"u"){const B=`keys=${encodeURIComponent(JSON.stringify(D.keys))}`;B.length+k.length+1<=2e3?k+=(k[0]==="?"?"&":"?")+B:(I="POST",typeof w=="string"?E={keys:D.keys}:w.keys=D.keys)}if(typeof w=="string"){const A=mt(w),B=await h.fetch("_design/"+A[0]+"/_view/"+A[1]+k,{headers:new je({"Content-Type":"application/json"}),method:I,body:JSON.stringify(E)});M=B.ok;const N=await B.json();if(!M)throw N.status=B.status,Ne(N);for(const F of N.rows)if(F.value&&F.value.error&&F.value.error==="builtin_reduce_error")throw new Error(F.reason);return new Promise(function(F){F(N)}).then(g(D))}E=E||{};for(const A of Object.keys(w))Array.isArray(w[A])?E[A]=w[A]:E[A]=w[A].toString();const R=await h.fetch("_temp_view"+k,{headers:new je({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(E)});M=R.ok;const b=await R.json();if(!M)throw b.status=R.status,Ne(b);return new Promise(function(A){A(b)}).then(g(D))}function d(h,w,D){return new Promise(function(k,E){h._query(w,D,function(I,M){if(I)return E(I);k(M)})})}function m(h){return new Promise(function(w,D){h._viewCleanup(function(k,E){if(k)return D(k);w(E)})})}function y(h){return function(w){if(w.status===404)return h;throw w}}async function O(h,w,D){const k="_local/doc_"+h,E={_id:k,keys:[]},I=D.get(h),M=I[0],R=I[1];function b(){return ja(R)?Promise.resolve(E):w.db.get(k).catch(y(E))}function A(X){return X.keys.length?w.db.allDocs({keys:X.keys,include_docs:!0}):Promise.resolve({rows:[]})}function B(X,ee){const re=[],fe=new Set;for(const Y of ee.rows){const H=Y.doc;if(H&&(re.push(H),fe.add(H._id),H._deleted=!M.has(H._id),!H._deleted)){const Z=M.get(H._id);"value"in Z&&(H.value=Z.value)}}const pe=gt(M);for(const Y of pe)if(!fe.has(Y)){const H={_id:Y},Z=M.get(Y);"value"in Z&&(H.value=Z.value),re.push(H)}return X.keys=vn(pe.concat(X.keys)),re.push(X),re}const N=await b(),F=await A(N);return B(N,F)}function q(h){return h.sourceDB.get("_local/purges").then(function(w){const D=w.purgeSeq;return h.db.get("_local/purgeSeq").then(function(k){return k._rev}).catch(y(void 0)).then(function(k){return h.db.put({_id:"_local/purgeSeq",_rev:k,purgeSeq:D})})}).catch(function(w){if(w.status!==404)throw w})}function x(h,w,D){var k="_local/lastSeq";return h.db.get(k).catch(y({_id:k,seq:0})).then(function(E){var I=gt(w);return Promise.all(I.map(function(M){return O(M,h,w)})).then(function(M){var R=M.flat();return E.seq=D,R.push(E),h.db.bulkDocs({docs:R})}).then(()=>q(h))})}function T(h){const w=typeof h=="string"?h:h.name;let D=yn[w];return D||(D=yn[w]=new Rt),D}async function P(h,w){return _t(T(h),function(){return C(h,w)})()}async function C(h,w){let D,k,E;function I(Y,H){const Z={id:k._id,key:Be(Y)};typeof H<"u"&&H!==null&&(Z.value=Be(H)),D.push(Z)}const M=e(h.mapFun,I);let R=h.seq||0;function b(){return h.sourceDB.info().then(function(Y){E=h.sourceDB.activeTasks.add({name:"view_indexing",total_items:Y.update_seq-R})})}function A(Y,H){return function(){return x(h,Y,H)}}let B=0;const N={view:h.name,indexed_docs:B};h.sourceDB.emit("indexing",N);const F=new Rt;async function X(){const Y=await h.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:R,limit:w.changes_batch_size}),H=await ee();return re(Y,H)}function ee(){return h.db.get("_local/purgeSeq").then(function(Y){return Y.purgeSeq}).catch(y(-1)).then(function(Y){return h.sourceDB.get("_local/purges").then(function(H){const Z=H.purges.filter(function(le,oe){return oe>Y}).map(le=>le.docId),_e=Z.filter(function(le,oe){return Z.indexOf(le)===oe});return Promise.all(_e.map(function(le){return h.sourceDB.get(le).then(function(oe){return{docId:le,doc:oe}}).catch(y({docId:le}))}))}).catch(y([]))})}function re(Y,H){const Z=Y.results;if(!Z.length&&!H.length)return;for(const oe of H)if(Z.findIndex(function(Ke){return Ke.id===oe.docId})<0){const Ke={_id:oe.docId,doc:{_id:oe.docId,_deleted:1},changes:[]};oe.doc&&(Ke.doc=oe.doc,Ke.changes.push({rev:oe.doc._rev})),Z.push(Ke)}const _e=fe(Z);F.add(A(_e,R)),B=B+Z.length;const le={view:h.name,last_seq:Y.last_seq,results_count:Z.length,indexed_docs:B};if(h.sourceDB.emit("indexing",le),h.sourceDB.activeTasks.update(E,{completed_items:B}),!(Z.length<w.changes_batch_size))return X()}function fe(Y){const H=new Map;for(const Z of Y){if(Z.doc._id[0]!=="_"){D=[],k=Z.doc,k._deleted||i(h.sourceDB,M,k),D.sort(s);const _e=pe(D);H.set(Z.doc._id,[_e,Z.changes])}R=Z.seq}return H}function pe(Y){const H=new Map;let Z;for(let _e=0,le=Y.length;_e<le;_e++){const oe=Y[_e],at=[oe.key,oe.id];_e>0&&ne(oe.key,Z)===0&&at.push(_e),H.set(me(at),oe),Z=oe.key}return H}try{await b(),await X(),await F.finish(),h.seq=R,h.sourceDB.activeTasks.remove(E)}catch(Y){h.sourceDB.activeTasks.remove(E,Y)}}function K(h,w,D){D.group_level===0&&delete D.group_level;const k=D.group||D.group_level,E=n(h.reduceFun),I=[],M=isNaN(D.group_level)?Number.POSITIVE_INFINITY:D.group_level;for(const R of w){const b=I[I.length-1];let A=k?R.key:null;if(k&&Array.isArray(A)&&(A=A.slice(0,M)),b&&ne(b.groupKey,A)===0){b.keys.push([R.key,R.id]),b.values.push(R.value);continue}I.push({keys:[[R.key,R.id]],values:[R.value],groupKey:A})}w=[];for(const R of I){const b=a(h.sourceDB,E,R.keys,R.values,!1);if(b.error&&b.error instanceof it)throw b.error;w.push({value:b.error?null:b.output,key:R.groupKey})}return{rows:u(w,D.limit,D.skip)}}function j(h,w){return _t(T(h),function(){return U(h,w)})()}async function U(h,w){let D;const k=h.reduceFun&&w.reduce!==!1,E=w.skip||0;typeof w.keys<"u"&&!w.keys.length&&(w.limit=0,delete w.keys);async function I(R){R.include_docs=!0;const b=await h.db.allDocs(R);return D=b.total_rows,b.rows.map(function(A){if("value"in A.doc&&typeof A.doc.value=="object"&&A.doc.value!==null){const N=Object.keys(A.doc.value).sort(),F=["id","key","value"];if(!(N<F||N>F))return A.doc.value}const B=Ci(A.doc._id);return{key:B[0],id:B[1],value:"value"in A.doc?A.doc.value:null}})}async function M(R){let b;if(k?b=K(h,R,w):typeof w.keys>"u"?b={total_rows:D,offset:E,rows:R}:b={total_rows:D,offset:E,rows:u(R,w.limit,w.skip)},w.update_seq&&(b.update_seq=h.seq),w.include_docs){const A=vn(R.map(c)),B=await h.sourceDB.allDocs({keys:A,include_docs:!0,conflicts:w.conflicts,attachments:w.attachments,binary:w.binary}),N=new Map;for(const F of B.rows)N.set(F.id,F.doc);for(const F of R){const X=c(F),ee=N.get(X);ee&&(F.doc=ee)}}return b}if(typeof w.keys<"u"){const b=w.keys.map(function(N){const F={startkey:me([N]),endkey:me([N,{}])};return w.update_seq&&(F.update_seq=!0),I(F)}),B=(await Promise.all(b)).flat();return M(B)}else{const R={descending:w.descending};w.update_seq&&(R.update_seq=!0);let b,A;if("start_key"in w&&(b=w.start_key),"startkey"in w&&(b=w.startkey),"end_key"in w&&(A=w.end_key),"endkey"in w&&(A=w.endkey),typeof b<"u"&&(R.startkey=w.descending?me([b,{}]):me([b])),typeof A<"u"){let N=w.inclusive_end!==!1;w.descending&&(N=!N),R.endkey=me(N?[A,{}]:[A])}if(typeof w.key<"u"){const N=me([w.key]),F=me([w.key,{}]);R.descending?(R.endkey=N,R.startkey=F):(R.startkey=N,R.endkey=F)}k||(typeof w.limit=="number"&&(R.limit=w.limit),R.skip=E);const B=await I(R);return M(B)}}async function $(h){return(await h.fetch("_view_cleanup",{headers:new je({"Content-Type":"application/json"}),method:"POST"})).json()}async function L(h){try{const w=await h.get("_local/"+t),D=new Map;for(const b of Object.keys(w.views)){const A=mt(b),B="_design/"+A[0],N=A[1];let F=D.get(B);F||(F=new Set,D.set(B,F)),F.add(N)}const k={keys:gt(D),include_docs:!0},E=await h.allDocs(k),I={};for(const b of E.rows){const A=b.key.substring(8);for(const B of D.get(b.key)){let N=A+"/"+B;w.views[N]||(N=B);const F=Object.keys(w.views[N]),X=b.doc&&b.doc.views&&b.doc.views[B];for(const ee of F)I[ee]=I[ee]||X}}const R=Object.keys(I).filter(function(b){return!I[b]}).map(function(b){return _t(T(b),function(){return new h.constructor(b,h.__opts).destroy()})()});return Promise.all(R).then(function(){return{ok:!0}})}catch(w){if(w.status===404)return{ok:!0};throw w}}async function z(h,w,D){if(typeof h._query=="function")return d(h,w,D);if(Se(h))return _(h,w,D);const k={changes_batch_size:h.__opts.view_update_changes_batch_size||Ia};if(typeof w!="string")return S(D,w),pn.add(async function(){const E=await mn(h,"temp_view/temp_view",w.map,w.reduce,!0,t);return xa(P(E,k).then(function(){return j(E,D)}),function(){return E.db.destroy()})}),pn.finish();{const E=w,I=mt(E),M=I[0],R=I[1],b=await h.get("_design/"+M);if(w=b.views&&b.views[R],!w)throw new rt(`ddoc ${b._id} has no view named ${R}`);r(b,R),S(D,w);const A=await mn(h,E,w.map,w.reduce,!1,t);return D.stale==="ok"||D.stale==="update_after"?(D.stale==="update_after"&&ke(function(){P(A,k)}),j(A,D)):(await P(A,k),j(A,D))}}function Q(h,w,D){const k=this;typeof w=="function"&&(D=w,w={}),w=w?v(w):{},typeof h=="function"&&(h={map:h});const E=Promise.resolve().then(function(){return z(k,h,w)});return sr(E,D),E}const W=Ea(function(){const h=this;return typeof h._viewCleanup=="function"?m(h):Se(h)?$(h):L(h)});return{query:Q,viewCleanup:W}}var yt={_sum:function(t,e){return Pt(e)},_count:function(t,e){return e.length},_stats:function(t,e){function n(r){for(var i=0,a=0,s=r.length;a<s;a++){var u=r[a];i+=u*u}return i}return{sum:Pt(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:n(e)}}};function La(t){if(/^_sum/.test(t))return yt._sum;if(/^_count/.test(t))return yt._count;if(/^_stats/.test(t))return yt._stats;if(/^_/.test(t))throw new Error(t+" is not a supported reduce function.")}function Na(t,e){if(typeof t=="function"&&t.length===2){var n=t;return function(r){return n(r,e)}}else return or(t.toString(),e)}function Ka(t){var e=t.toString(),n=La(e);return n||or(e)}function Fa(t,e){var n=t.views&&t.views[e];if(typeof n.map!="string")throw new rt("ddoc "+t._id+" has no string view named "+e+", instead found object of type: "+typeof n.map)}var Ma="mrviews",ur=$a(Ma,Na,Ka,Fa);function Ga(t,e,n){return ur.query.call(this,t,e,n)}function Ua(t){return ur.viewCleanup.call(this,t)}var Ja={query:Ga,viewCleanup:Ua};function za(t,e,n){return!t._attachments||!t._attachments[n]||t._attachments[n].digest!==e._attachments[n].digest}function bn(t,e){var n=Object.keys(e._attachments);return Promise.all(n.map(function(r){return t.getAttachment(e._id,r,{rev:e._rev})}))}function Qa(t,e,n){var r=Se(e)&&!Se(t),i=Object.keys(n._attachments);return r?t.get(n._id).then(function(a){return Promise.all(i.map(function(s){return za(a,n,s)?e.getAttachment(n._id,s):t.getAttachment(a._id,s)}))}).catch(function(a){if(a.status!==404)throw a;return bn(e,n)}):bn(e,n)}function Wa(t){var e=[];return Object.keys(t).forEach(function(n){var r=t[n].missing;r.forEach(function(i){e.push({id:n,rev:i})})}),{docs:e,revs:!0,latest:!0}}function Ha(t,e,n,r){n=se(n);var i=[],a=!0;function s(){var c=Wa(n);if(c.docs.length)return t.bulkGet(c).then(function(l){if(r.cancelled)throw new Error("cancelled");return Promise.all(l.results.map(function(g){return Promise.all(g.docs.map(function(o){var f=o.ok;return o.error&&(a=!1),!f||!f._attachments?f:Qa(e,t,f).then(v=>{var p=Object.keys(f._attachments);return v.forEach(function(S,_){var d=f._attachments[p[_]];delete d.stub,delete d.length,d.data=S}),f})}))})).then(function(g){i=i.concat(g.flat().filter(Boolean))})})}function u(){return{ok:a,docs:i}}return Promise.resolve().then(s).then(u)}var Sn=1,kn="pouchdb",Ya=5,ge=0;function Bt(t,e,n,r,i){return t.get(e).catch(function(a){if(a.status===404)return(t.adapter==="http"||t.adapter==="https")&&bt(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:e,history:[],replicator:kn,version:Sn};throw a}).then(function(a){if(!i.cancelled&&a.last_seq!==n)return a.history=(a.history||[]).filter(function(s){return s.session_id!==r}),a.history.unshift({last_seq:n,session_id:r}),a.history=a.history.slice(0,Ya),a.version=Sn,a.replicator=kn,a.session_id=r,a.last_seq=n,t.put(a).catch(function(s){if(s.status===409)return Bt(t,e,n,r,i);throw s})})}class qn{constructor(e,n,r,i,a={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0}){this.src=e,this.target=n,this.id=r,this.returnValue=i,this.opts=a,typeof a.writeSourceCheckpoint>"u"&&(a.writeSourceCheckpoint=!0),typeof a.writeTargetCheckpoint>"u"&&(a.writeTargetCheckpoint=!0)}writeCheckpoint(e,n){var r=this;return this.updateTarget(e,n).then(function(){return r.updateSource(e,n)})}updateTarget(e,n){return this.opts.writeTargetCheckpoint?Bt(this.target,this.id,e,n,this.returnValue):Promise.resolve(!0)}updateSource(e,n){if(this.opts.writeSourceCheckpoint){var r=this;return Bt(this.src,this.id,e,n,this.returnValue).catch(function(i){if(On(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}else return Promise.resolve(!0)}getCheckpoint(){var e=this;return!e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?Promise.resolve(ge):e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(n){return n.last_seq||ge}).catch(function(n){if(n.status!==404)throw n;return ge}):e.target.get(e.id).then(function(n){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?n.last_seq||ge:e.src.get(e.id).then(function(r){if(n.version!==r.version)return ge;var i;return n.version?i=n.version.toString():i="undefined",i in An?An[i](n,r):ge},function(r){if(r.status===404&&n.last_seq)return e.src.put({_id:e.id,last_seq:ge}).then(function(){return ge},function(i){return On(i)?(e.opts.writeSourceCheckpoint=!1,n.last_seq):ge});throw r})}).catch(function(n){if(n.status!==404)throw n;return ge})}}var An={undefined:function(t,e){return ne(t.last_seq,e.last_seq)===0?e.last_seq:0},1:function(t,e){return Xa(e,t).last_seq}};function Xa(t,e){return t.session_id===e.session_id?{last_seq:t.last_seq,history:t.history}:cr(t.history,e.history)}function cr(t,e){var n=t[0],r=t.slice(1),i=e[0],a=e.slice(1);if(!n||e.length===0)return{last_seq:ge,history:[]};var s=n.session_id;if(It(s,e))return{last_seq:n.last_seq,history:t};var u=i.session_id;return It(u,r)?{last_seq:i.last_seq,history:a}:cr(r,a)}function It(t,e){var n=e[0],r=e.slice(1);return!t||e.length===0?!1:t===n.session_id?!0:It(t,r)}function On(t){return typeof t.status=="number"&&Math.floor(t.status/100)===4}function fr(t,e,n,r,i){return this instanceof qn?fr:new qn(t,e,n,r,i)}var Dn=0;function Za(t,e,n,r){if(t.retry===!1){e.emit("error",n),e.removeAllListeners();return}if(typeof t.back_off_function!="function"&&(t.back_off_function=br),e.emit("requestError",n),e.state==="active"||e.state==="pending"){e.emit("paused",n),e.state="stopped";var i=function(){t.current_back_off=Dn},a=function(){e.removeListener("active",i)};e.once("paused",a),e.once("active",i)}t.current_back_off=t.current_back_off||Dn,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(r,t.current_back_off)}function Va(t){return Object.keys(t).sort(ne).reduce(function(e,n){return e[n]=t[n],e},{})}function es(t,e,n){var r=n.doc_ids?n.doc_ids.sort(ne):"",i=n.filter?n.filter.toString():"",a="",s="",u="";return n.selector&&(u=JSON.stringify(n.selector)),n.filter&&n.query_params&&(a=JSON.stringify(Va(n.query_params))),n.filter&&n.filter==="_view"&&(s=n.view.toString()),Promise.all([t.id(),e.id()]).then(function(c){var l=c[0]+c[1]+i+s+a+r+u;return new Promise(function(g){Qt(l,g)})}).then(function(c){return c=c.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+c})}function lr(t,e,n,r,i){var a=[],s,u={seq:0,changes:[],docs:[]},c=!1,l=!1,g=!1,o=0,f=0,v=n.continuous||n.live||!1,p=n.batch_size||100,S=n.batches_limit||10,_=n.style||"all_docs",d=!1,m=n.doc_ids,y=n.selector,O,q,x=[],T=nt(),P;i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var C={};r.ready(t,e);function K(){return q?Promise.resolve():es(t,e,n).then(function(b){O=b;var A={};n.checkpoint===!1?A={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?A={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?A={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:A={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},q=new fr(t,e,O,r,A)})}function j(){if(x=[],s.docs.length!==0){var b=s.docs,A={timeout:n.timeout};return e.bulkDocs({docs:b,new_edits:!1},A).then(function(B){if(r.cancelled)throw h(),new Error("cancelled");var N=Object.create(null);B.forEach(function(X){X.error&&(N[X.id]=X)});var F=Object.keys(N).length;i.doc_write_failures+=F,i.docs_written+=b.length-F,b.forEach(function(X){var ee=N[X._id];if(ee){i.errors.push(ee);var re=(ee.name||"").toLowerCase();if(re==="unauthorized"||re==="forbidden")r.emit("denied",se(ee));else throw ee}else x.push(X)})},function(B){throw i.doc_write_failures+=b.length,B})}}function U(){if(s.error)throw new Error("There was a problem getting docs.");i.last_seq=f=s.seq;var b=se(i);return x.length&&(b.docs=x,typeof s.pending=="number"&&(b.pending=s.pending,delete s.pending),r.emit("change",b)),c=!0,t.info().then(function(A){var B=t.activeTasks.get(P);if(!(!s||!B)){var N=B.completed_items||0,F=parseInt(A.update_seq,10)-parseInt(o,10);t.activeTasks.update(P,{completed_items:N+s.changes.length,total_items:F})}}),q.writeCheckpoint(s.seq,T).then(function(){if(r.emit("checkpoint",{checkpoint:s.seq}),c=!1,r.cancelled)throw h(),new Error("cancelled");s=void 0,E()}).catch(function(A){throw R(A),A})}function $(){var b={};return s.changes.forEach(function(A){r.emit("checkpoint",{revs_diff:A}),A.id!=="_user/"&&(b[A.id]=A.changes.map(function(B){return B.rev}))}),e.revsDiff(b).then(function(A){if(r.cancelled)throw h(),new Error("cancelled");s.diffs=A})}function L(){return Ha(t,e,s.diffs,r).then(function(b){s.error=!b.ok,b.docs.forEach(function(A){delete s.diffs[A._id],i.docs_read++,s.docs.push(A)})})}function z(){if(!(r.cancelled||s)){if(a.length===0){Q(!0);return}s=a.shift(),r.emit("checkpoint",{start_next_batch:s.seq}),$().then(L).then(j).then(U).then(z).catch(function(b){W("batch processing terminated with error",b)})}}function Q(b){if(u.changes.length===0){a.length===0&&!s&&((v&&C.live||l)&&(r.state="pending",r.emit("paused")),l&&h());return}(b||l||u.changes.length>=p)&&(a.push(u),u={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),z())}function W(b,A){g||(A.message||(A.message=b),i.ok=!1,i.status="aborting",a=[],u={seq:0,changes:[],docs:[]},h(A))}function h(b){if(!g&&!(r.cancelled&&(i.status="cancelled",c)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=f,g=!0,t.activeTasks.remove(P,b),b){b=G(b),b.result=i;var A=(b.name||"").toLowerCase();A==="unauthorized"||A==="forbidden"?(r.emit("error",b),r.removeAllListeners()):Za(n,r,b,function(){lr(t,e,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function w(b,A,B){if(r.cancelled)return h();typeof A=="number"&&(u.pending=A);var N=Kt(n)(b);if(!N){var F=t.activeTasks.get(P);if(F){var X=F.completed_items||0;t.activeTasks.update(P,{completed_items:++X})}return}u.seq=b.seq||B,u.changes.push(b),r.emit("checkpoint",{pending_batch:u.seq}),ke(function(){Q(a.length===0&&C.live)})}function D(b){if(d=!1,r.cancelled)return h();if(b.results.length>0)C.since=b.results[b.results.length-1].seq,E(),Q(!0);else{var A=function(){v?(C.live=!0,E()):l=!0,Q(!0)};!s&&b.results.length===0?(c=!0,q.writeCheckpoint(b.last_seq,T).then(function(){if(c=!1,i.last_seq=f=b.last_seq,r.cancelled)throw h(),new Error("cancelled");A()}).catch(R)):A()}}function k(b){if(d=!1,r.cancelled)return h();W("changes rejected",b)}function E(){if(!(!d&&!l&&a.length<S))return;d=!0;function b(){B.cancel()}function A(){r.removeListener("cancel",b)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",b);var B=t.changes(C).on("change",w);B.then(A,A),B.then(D).catch(k),n.retry&&(r._changes=B,r._abortChanges=b)}function I(b){return t.info().then(function(A){var B=typeof n.since>"u"?parseInt(A.update_seq,10)-parseInt(b,10):parseInt(A.update_seq,10);return P=t.activeTasks.add({name:`${v?"continuous ":""}replication from ${A.db_name}`,total_items:B}),b})}function M(){K().then(function(){if(r.cancelled){h();return}return q.getCheckpoint().then(I).then(function(b){f=b,o=b,C={since:f,limit:p,batch_size:p,style:_,doc_ids:m,selector:y,return_docs:!0},n.filter&&(typeof n.filter!="string"?C.include_docs=!0:C.filter=n.filter),"heartbeat"in n&&(C.heartbeat=n.heartbeat),"timeout"in n&&(C.timeout=n.timeout),n.query_params&&(C.query_params=n.query_params),n.view&&(C.view=n.view),E()})}).catch(function(b){W("getCheckpoint rejected with ",b)})}function R(b){c=!1,W("writeCheckpoint completed with error",b)}if(r.cancelled){h();return}r._addedListeners||(r.once("cancel",h),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(b){n.complete(null,b)})),r._addedListeners=!0),typeof n.since>"u"?M():K().then(function(){return c=!0,q.writeCheckpoint(n.since,T)}).then(function(){if(c=!1,r.cancelled){h();return}f=n.since,M()}).catch(R)}class ts extends Ae{constructor(){super(),this.cancelled=!1,this.state="pending";const e=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return e.then(n,r)},this.catch=function(n){return e.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(e,n){if(this._readyCalled)return;this._readyCalled=!0;const r=()=>{this.cancel()};e.once("destroyed",r),n.once("destroyed",r);function i(){e.removeListener("destroyed",r),n.removeListener("destroyed",r)}this.once("complete",i),this.once("error",i)}}function et(t,e){var n=e.PouchConstructor;return typeof t=="string"?new n(t,e):t}function jt(t,e,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw G(tt,"`doc_ids` filter parameter is not a list.");n.complete=r,n=se(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new ts(n),a=et(t,n),s=et(e,n);return lr(a,s,n,i),i}function ns(t,e,n,r){return typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n=se(n),n.PouchConstructor=n.PouchConstructor||this,t=et(t,n),e=et(e,n),new rs(t,e,n,r)}class rs extends Ae{constructor(e,n,r,i){super(),this.canceled=!1;const a=r.push?Object.assign({},r,r.push):r,s=r.pull?Object.assign({},r,r.pull):r;this.push=jt(e,n,a),this.pull=jt(n,e,s),this.pushPaused=!0,this.pullPaused=!0;const u=y=>{this.emit("change",{direction:"pull",change:y})},c=y=>{this.emit("change",{direction:"push",change:y})},l=y=>{this.emit("denied",{direction:"push",doc:y})},g=y=>{this.emit("denied",{direction:"pull",doc:y})},o=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},f=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},v=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},p=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})};let S={};const _=y=>(O,q)=>{(O==="change"&&(q===u||q===c)||O==="denied"&&(q===g||q===l)||O==="paused"&&(q===f||q===o)||O==="active"&&(q===p||q===v))&&(O in S||(S[O]={}),S[O][y]=!0,Object.keys(S[O]).length===2&&this.removeAllListeners(O))};r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push)));function d(y,O,q){y.listeners(O).indexOf(q)==-1&&y.on(O,q)}this.on("newListener",function(y){y==="change"?(d(this.pull,"change",u),d(this.push,"change",c)):y==="denied"?(d(this.pull,"denied",g),d(this.push,"denied",l)):y==="active"?(d(this.pull,"active",p),d(this.push,"active",v)):y==="paused"&&(d(this.pull,"paused",f),d(this.push,"paused",o))}),this.on("removeListener",function(y){y==="change"?(this.pull.removeListener("change",u),this.push.removeListener("change",c)):y==="denied"?(this.pull.removeListener("denied",g),this.push.removeListener("denied",l)):y==="active"?(this.pull.removeListener("active",p),this.push.removeListener("active",v)):y==="paused"&&(this.pull.removeListener("paused",f),this.push.removeListener("paused",o))}),this.pull.on("removeListener",_("pull")),this.push.on("removeListener",_("push"));const m=Promise.all([this.push,this.pull]).then(y=>{const O={push:y[0],pull:y[1]};return this.emit("complete",O),i&&i(null,O),this.removeAllListeners(),O},y=>{if(this.cancel(),i?i(y):this.emit("error",y),this.removeAllListeners(),i)throw y});this.then=function(y,O){return m.then(y,O)},this.catch=function(y){return m.catch(y)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}}function is(t){t.replicate=jt,t.sync=ns,Object.defineProperty(t.prototype,"replicate",{get:function(){var e=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return e.constructor.replicate(n,e,r,i)},to:function(n,r,i){return e.constructor.replicate(e,n,r,i)}}),this.replicateMethods}}),t.prototype.sync=function(e,n,r){return this.constructor.sync(this,e,n,r)}}J.plugin(wa).plugin(Ca).plugin(Ja).plugin(is);export{J as P};
